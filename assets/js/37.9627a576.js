(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{396:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"aws-iot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aws-iot","aria-hidden":"true"}},[t._v("#")]),t._v(" AWS IoT")]),t._v(" "),a("h2",{attrs:{id:"平台架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#平台架构","aria-hidden":"true"}},[t._v("#")]),t._v(" 平台架构")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/e46d02610b899f7fbcb94fdad791f2b2/image.png",alt:"image"}})]),t._v(" "),a("h2",{attrs:{id:"aws服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aws服务","aria-hidden":"true"}},[t._v("#")]),t._v(" AWS服务")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/3c78702c065f7b113a1f7be6ade53cc1/image.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("Amazon DynamoDB—托管NoSQL数据库")]),t._v(" "),a("li",[t._v("Amazon Kinesis—大规模流式数据实时处理")]),t._v(" "),a("li",[t._v("AWS Lambda—EC2云虚拟机运行代码响应事件")]),t._v(" "),a("li",[t._v("Amazon Simple Storage Service（S3）—可扩展云存储")]),t._v(" "),a("li",[t._v("Amazon Simple Notification—推送通知服务")]),t._v(" "),a("li",[t._v("Amazon Simple Queue Service—消息队列服务")])]),t._v(" "),a("h2",{attrs:{id:"sdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sdk","aria-hidden":"true"}},[t._v("#")]),t._v(" SDK")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/7d868a5192913c289a3ea608787c82d7/image.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("AWS IoT 设备 SDK 使用 MQTT、HTTP 或 WebSockets 协议将硬件设备连接到 AWS IoT，硬件设备无缝安全地与 AWS IoT 提供的设备网关和设备影子协作。")]),t._v(" "),a("li",[t._v("设备 SDK 支持 C、JavaScript 、Arduino、Java和Python。")]),t._v(" "),a("li",[t._v("设备 SDK 包含开源库、带有示例的开发人员指南和移植指南，用户根据硬件平台构建 IoT 产品或解决方案。")])]),t._v(" "),a("p",[t._v("设备网关")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/12a0c3a63e85a60a2644e42f53b59f61/image.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("AWS IoT 设备网关支持设备安全高效地与 AWS IoT 进行通信。设备网关可以使用发布/订阅模式交换消息，从而支持一对一和一对多的通信。凭借此一对多的通信模式，AWS IoT 将支持互连设备向多名给定主题的订阅者广播数据。")]),t._v(" "),a("li",[t._v("设备网关支持 MQTT、WebSocket 和 HTTP 1.1 协议，也支持私有协议。")]),t._v(" "),a("li",[t._v("设备网关可自动扩展，以支持 10 亿多台设备，而无需预配置基础设施。")])]),t._v(" "),a("h2",{attrs:{id:"认证和授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#认证和授权","aria-hidden":"true"}},[t._v("#")]),t._v(" 认证和授权")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/46f0e7944563e1a9b91275933f7fd067/image.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v('AWS IoT 在所有连接点处提供相互身份验证和加密。AWS IoT 支持 AWS 身份验证方法（称为"SigV4"）以及基于身份验证的 X.509 证书。使用 HTTP 的连接可以使用任一方法，使用 MQTT 的连接可以使用基于证书的身份验证，使用 WebSockets 的连接可以使用 SigV4。')]),t._v(" "),a("li",[t._v("使用 AWS IoT 生成的证书以及由首选证书颁发机构 (CA) 签署的证书，将所选的角色和/或策略映射到每个证书，以便授予设备或应用程序访问权限，或撤消访问权限。")]),t._v(" "),a("li",[t._v("通过控制台或使用 API 创建、部署并管理设备的证书和策略。这些设备证书可以预配置、激活和与使用 AWS IAM 配置的相关策略关联。")]),t._v(" "),a("li",[t._v("AWS IoT 还支持用户移动应用使用 Amazon Cognito 进行连接，Amazon Cognito 将负责执行必要的操作来为应用用户创建唯一标识符并获取临时的、权限受限的 AWS 凭证")])]),t._v(" "),a("h2",{attrs:{id:"注册表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册表","aria-hidden":"true"}},[t._v("#")]),t._v(" 注册表")]),t._v(" "),a("ul",[a("li",[t._v("注册表将创建设备标识并跟踪元数据，如设备的属性和功能。")]),t._v(" "),a("li",[t._v("注册表向格式一致的每台设备分配唯一的标识，而不管设备的类型和连接方式为何。此外，它还支持描述设备功能的元数据，例如传感器是否报告温度，以及数据是华氏度还是摄氏度。")]),t._v(" "),a("li",[t._v("注册表存储有关设备的元数据，无需支付额外费用；并且需要每隔 7 天至少访问或更新注册表条目一次，注册表中的元数据就不会过期。")])]),t._v(" "),a("p",[t._v("以JSON格式存储的设备注册表信息\n"),a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/75a353f4bb6247473ede44eedf1296ae/image.png",alt:"image"}})]),t._v(" "),a("h2",{attrs:{id:"shadow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shadow","aria-hidden":"true"}},[t._v("#")]),t._v(" Shadow")]),t._v(" "),a("h3",{attrs:{id:"shadow服务用途"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shadow服务用途","aria-hidden":"true"}},[t._v("#")]),t._v(" Shadow服务用途")]),t._v(" "),a("p",[t._v("设备的影子 是用于存储和检索设备的当前状态信息的 JSON 文档。Device Shadow 服务可以为您连接到 AWS IoT 的每台设备保留一个影子。您可以使用该影子通过 MQTT 或 HTTP 获取和设置设备的状态，无论该设备是否连接到 Internet。每台设备的影子都由相应事物的名称唯一标识。\n"),a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/279677d104aebb87e5c294fd012822ff/image.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("设备影子保留每台设备的最后报告状态和期望的未来状态，即便设备处于离线状态。")]),t._v(" "),a("li",[t._v("通过 API 或使用规则引擎，获取设备的最后报告状态或设置期望的未来状态。")]),t._v(" "),a("li",[t._v('应用程序可以设置设备的期望未来状态，而无需说明设备的当前状态。AWS IoT 将比较期望未来状态和最后报告状态之间的差异，并命令设备"弥补差异"。')]),t._v(" "),a("li",[t._v("设备 SDK 能够轻松地同步其状态及其影子，并响应通过影子设置的期望的未来状态。")]),t._v(" "),a("li",[t._v("设备影子免费存储设备状态多达一年。如果至少每年更新一次状态，则设备影子将永久保留状态；否则状态将过期。")])]),t._v(" "),a("h3",{attrs:{id:"影子服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#影子服务","aria-hidden":"true"}},[t._v("#")]),t._v(" 影子服务")]),t._v(" "),a("p",[t._v("设备影子服务使用MQTT话题，便于应用和设备之间的通信，下面是相关的MQTT QoS 1话题：")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/update")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/get")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/delete")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/update/accepted")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/update/rejected")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/update/delta")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/get/accepted")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/get/rejected")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/delete/accepted")]),t._v(" "),a("p",[t._v("$aws/things/{thingName}/shadow/delete/rejected")]),t._v(" "),a("p",[t._v("设备SDK（C-SDK、JS-SDK）将影子功能内置在设备中，能够使设备与影子服务之间自动同步状态。")]),t._v(" "),a("h3",{attrs:{id:"控制模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制模型","aria-hidden":"true"}},[t._v("#")]),t._v(" 控制模型")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/1b53521c576beb953300cb573babb736/image.png",alt:"image"}}),t._v("\n控制灯泡\n"),a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/9a921de9c2d510a251b789aaf60d5416/image.png",alt:"image"}})]),t._v(" "),a("h3",{attrs:{id:"工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作原理","aria-hidden":"true"}},[t._v("#")]),t._v(" 工作原理")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/fa8daac0611b0f4ffe080aed7062ecf8/image.png",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/37da2277a08fcca859c153b6834efe42/image.png",alt:"image"}})]),t._v(" "),a("p",[t._v("1.连接着的 Led 灯发送封装在MQTT消息中的 reported 状态 『off』 到 AWS IoT\n2.AWS IoT 通过 led 灯使用的证书来确定它所属的虚拟事物\n3.AWS IoT 将 reported 状态保存在设备影子 JSON 文件中\n4.一条 AWS IoT rule 正监控着 led 的 off 状态，它发送一个消息到某个 SNS topic\n5.某 application 收到 SNS 消息。用户将 led 期望状态（desired state）设置为 on\n6. AWS IoT 收到该消息，它更新设备影子中的 desired state，同时发送包含期望状态的 message 到某些topic。此时，reported 和 desired 状态是 『Out of Sync』的\n7. led 收到 delta 消息，开始根据其中的 desired status 来设置其实际状态\n8. led 将其状态设置为 on，向 MQTT topic 发送新的 reported 状态\n9. AWS IoT 更新设备影子，现在该设备的 reported 和 desired 状态一致了")]),t._v(" "),a("h3",{attrs:{id:"格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#格式","aria-hidden":"true"}},[t._v("#")]),t._v(" 格式")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/ba398a3c48b6b7d77d8a2f048735550a/image.png",alt:"image"}})]),t._v(" "),a("h3",{attrs:{id:"关键属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键属性","aria-hidden":"true"}},[t._v("#")]),t._v(" 关键属性")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://git.manystar.com/marszhang/notebook-mars/uploads/e2b49474ae7db2783464ea52d205acfd/image.png",alt:"image"}})]),t._v(" "),a("h4",{attrs:{id:"影子文档属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#影子文档属性","aria-hidden":"true"}},[t._v("#")]),t._v(" 影子文档属性")]),t._v(" "),a("p",[t._v("设备的影子文档具有以下属性：")]),t._v(" "),a("ul",[a("li",[t._v("state")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("desired 事物的预期状态。应用程序可以向本文档部分写入数据来更新事物的状态，且无需直接连接到该事物。")])]),t._v(" "),a("li",[a("p",[t._v("reported 事物的报告状态。事物可以向本文档部分写入数据，以报告其新状态。应用程序可以读取本文档部分，以确定事物的状态。")])]),t._v(" "),a("li",[a("p",[t._v("metadata 有关存储在文档 state 部分的数据的信息，其中包括 state 部分中每个属性的时间戳（以 Epoch 时间表示），让您能够确定它们的更新时间。")])]),t._v(" "),a("li",[a("p",[t._v("timestamp 指明 AWS IoT 传输消息的时间。通过在消息中使用时间戳并对 desired 或 reported 部分中的不同属性使用时间戳，事物可以确定已更新项目的存在时间，即使它不具有内部时钟特性。")])]),t._v(" "),a("li",[a("p",[t._v("clientToken 特定于设备的字符串，让您能在 MQTT 环境中将响应与请求关联起来。")])]),t._v(" "),a("li",[a("p",[t._v("version 文档版本。文档每次更新时，此版本号都会递增。用于确保正在更新的文档为最新版本。")])])]),t._v(" "),a("h3",{attrs:{id:"影子文档语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#影子文档语法","aria-hidden":"true"}},[t._v("#")]),t._v(" 影子文档语法")]),t._v(" "),a("h4",{attrs:{id:"请求结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求结构","aria-hidden":"true"}},[t._v("#")]),t._v(" 请求结构")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"state"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token property"}},[t._v('"desired"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute1"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" integer2"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute2"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"string2"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            ...\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attributeN"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean2\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token property"}},[t._v('"reported"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute1"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" integer1"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute2"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"string1"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            ...\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attributeN"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean1\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"clientToken"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"token"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"version"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" version\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("h4",{attrs:{id:"响应状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#响应状态","aria-hidden":"true"}},[t._v("#")]),t._v(" 响应状态")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"state"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token property"}},[t._v('"desired"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute1"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" integer2"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute2"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"string2"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            ...\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attributeN"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean2\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token property"}},[t._v('"reported"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute1"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" integer1"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute2"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"string1"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            ...\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attributeN"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean1\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token property"}},[t._v('"delta"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute3"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" integerX"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute5"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"stringY"')]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"metadata"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token property"}},[t._v('"desired"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute1"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute2"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            ...\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attributeN"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token property"}},[t._v('"reported"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute1"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attribute2"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            ...\n            "),a("span",{attrs:{class:"token property"}},[t._v('"attributeN"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"clientToken"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"token"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"version"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" version\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br")])]),a("h4",{attrs:{id:"错误响应"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误响应","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误响应")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"code"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" error-code"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"message"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"error-message"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" timestamp"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"clientToken"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"token"')]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h3",{attrs:{id:"预留主题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预留主题","aria-hidden":"true"}},[t._v("#")]),t._v(" 预留主题")]),t._v(" "),a("p",[t._v("aws Iot预留了一些主题，预留的主题以$开头。除非下面列出的主题之外，不支持用于进行发布和订阅。在任何其他以 $ 开头的主题中尝试发布或订阅将导致连接被终止。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("主题")]),t._v(" "),a("th",[t._v("允许的操作")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("$aws/events/presence/connected/clientId")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当使用特定客户端 ID 的 MQTT 客户端连接至 AWS IoT 时，AWS IoT 将向此主题发布。有关更多信息，请参阅 连接/断开连接事件。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/events/presence/disconnected/clientId")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当使用特定客户端 ID 的 MQTT 客户端与 AWS IoT 断开连接时，AWS IoT 将向此主题发布。有关更多信息，请参阅 连接/断开连接事件。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/events/subscriptions/subscribed/clientId")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当使用特定客户端 ID 的 MQTT 客户端订阅 MQTT 主题时，AWS IoT 将向此主题发布。有关更多信息，请参阅 订阅/取消订阅事件。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/events/subscriptions/unsubscribed/clientId")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当使用特定客户端 ID 的 MQTT 客户端取消订阅 MQTT 主题时，AWS IoT 将向此主题发布。有关更多信息，请参阅 订阅/取消订阅事件。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/delete")]),t._v(" "),a("td",[t._v("发布/订阅")]),t._v(" "),a("td",[t._v("设备或应用程序向此主题发布消息以删除影子。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#delete-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/delete/accepted")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当一个影子被删除时，Device Shadow 服务将向此主题发送消息。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#delete-accepted-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/delete/rejected")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当删除影子的请求遭拒时，Device Shadow 服务将向此主题发送消息。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#delete-rejected-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/get")]),t._v(" "),a("td",[t._v("发布/订阅")]),t._v(" "),a("td",[t._v("应用程序或事物向此主题发布空消息来获取影子。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/get/accepted")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当获取影子的请求获批时，Device Shadow 服务将向此主题发送消息。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#get-accepted-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/get/rejected")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当获取影子的请求遭拒时，Device Shadow 服务将向此主题发送消息。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#get-rejected-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/update")]),t._v(" "),a("td",[t._v("发布/订阅")]),t._v(" "),a("td",[t._v("事物或应用程序向此主题发布消息以更新影子。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#update-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/update/accepted")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当影子更新成功时，Device Shadow 服务将向此主题发送消息。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#update-accepted-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/update/rejected")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当影子更新遭拒时，Device Shadow 服务将向此主题发送消息。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#update-rejected-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/update/delta")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("当检测到影子的“reported”部分与“desired”部分之间存在差异时，Device Shadow 服务将向此主题发送消息。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#update-delta-pub-sub-topic。")])]),t._v(" "),a("tr",[a("td",[t._v("$aws/things/thingName/shadow/update/documents")]),t._v(" "),a("td",[t._v("Subscribe")]),t._v(" "),a("td",[t._v("每次影子更新成功执行时，AWS IoT 都会向该主题发布状态文档。有关更多信息，请参阅 http://docs.aws.amazon.com/iot/latest/developerguide//device-shadow-mqtt.html#update-documents-pub-sub-topic。")])])])]),t._v(" "),a("h2",{attrs:{id:"sample-程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sample-程序","aria-hidden":"true"}},[t._v("#")]),t._v(" Sample 程序")]),t._v(" "),a("h3",{attrs:{id:"basicpubsub-py"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basicpubsub-py","aria-hidden":"true"}},[t._v("#")]),t._v(" basicPubSub.py")]),t._v(" "),a("p",[t._v("这个程序可以作publish也可以作subscribe，或者同时运行。")]),t._v(" "),a("p",[t._v("当publish时\n每隔1s产生一个消息")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("loopCount "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("True")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" args"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'both'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("or")]),t._v(" args"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'publish'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        message "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        message"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'message'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" args"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message\n        message"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'sequence'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" loopCount\n        messageJson "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dumps"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        myAWSIoTMQTTClient"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" messageJson"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" args"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'publish'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("print")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Published topic %s: %s\\n'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" messageJson"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        loopCount "),a("span",{attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("\n    time"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("当作subscribe时，由于注册了calback函数，在收到消息时候会有一个调用")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("customCallback")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userdata"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("print")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Received a new message: "')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("print")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("print")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"from topic: "')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("print")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("print")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"--------------\\n\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# Connect and subscribe to AWS IoT")]),t._v("\nmyAWSIoTMQTTClient"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" args"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'both'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("or")]),t._v(" args"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'subscribe'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    myAWSIoTMQTTClient"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subscribe"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" customCallback"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntime"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("输出如下：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("2018-08-16 17:23:51,459 - AWSIoTPythonSDK.core.protocol.internal.clients - DEBUG - Invoking custom event callback"),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n2018-08-16 17:23:56,435 - AWSIoTPythonSDK.core.protocol.internal.workers - DEBUG - Produced "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" event\n2018-08-16 17:23:56,435 - AWSIoTPythonSDK.core.protocol.internal.workers - DEBUG - Dispatching "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" event\nReceived a new message: \nb"),a("span",{attrs:{class:"token string"}},[t._v('\'{"message": "Hello World!", "sequence": 18}\'')]),t._v("\nfrom topic: \nsdk/test/Python\n--------------\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h3",{attrs:{id:"basicpubsubasync-py"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basicpubsubasync-py","aria-hidden":"true"}},[t._v("#")]),t._v(" basicPubSubAsync.py")]),t._v(" "),a("p",[t._v("注意ackCallback与messageCallback区别")]),t._v(" "),a("p",[a("em",[t._v("ackCallback")]),t._v(" - Callback to be invoked when the client receives a SUBACK. Should be in form\n"),a("em",[t._v("messageCallback")]),t._v(" - Function to be called when a new message for the subscribed topic comes in.")]),t._v(" "),a("p",[t._v('SUBACK： 服务端发送SUBACK报文给客户端，用于确认它已收到并且正在处理SUBSCRIBE报文。简单理解为服务器端通知订阅客户端"我知道你要订阅了"')]),t._v(" "),a("p",[t._v("详细参考：https://mcxiaoke.gitbooks.io/mqtt-cn/content/mqtt/0309-SUBACK.html")]),t._v(" "),a("h3",{attrs:{id:"异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常","aria-hidden":"true"}},[t._v("#")]),t._v(" 异常")]),t._v(" "),a("p",[t._v("sample程序可能会遇到exception，这多数是授权策略引起的。开发调试状态下")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"Version"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"2012-10-17"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"Statement"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"Effect"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Allow"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"Action"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('"iot:*"')]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"Resource"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])])])}],!1,null,null,null);e.options.__file="iot.md";s.default=e.exports}}]);