(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{373:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"sprintboot程序的单元测试和集成测试建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sprintboot程序的单元测试和集成测试建议","aria-hidden":"true"}},[t._v("#")]),t._v(" Sprintboot程序的单元测试和集成测试建议")]),t._v(" "),a("h2",{attrs:{id:"springboot测试注解说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot测试注解说明","aria-hidden":"true"}},[t._v("#")]),t._v(" Springboot测试注解说明")]),t._v(" "),a("h3",{attrs:{id:"springboottest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboottest","aria-hidden":"true"}},[t._v("#")]),t._v(" @SpringBootTest")]),t._v(" "),a("p",[t._v("当需要启动完成spring容器的时候考虑使用。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("如果没有指定使用注解@ContextConfiguration(loader=...)指定加载，SpringBootContextLoader就是默认的加载器。当没有嵌套使用@Configuration时候,会自动搜索 @SpringBootConfiguration注解。\n当我们用@SpringBootConfiguration标记一个类时，意味着该类提供了@Bean定义方法。Spring 容器为我们的应用程序实例化和配置 bean。\n@SpringBootConfiguration与@Configuration区别在于@SpringBootConfiguration允许自动发现配置。")])]),t._v(" "),a("li",[a("p",[t._v("@SpringBootTest会首先在当前包中搜索@SpringBootConfiguration，如果没有搜索到则根据包结构向上搜索。")])]),t._v(" "),a("li",[a("p",[t._v("测试类需要与@SpringbootApplication注解标记的类在同一个包内，或者在更下层的包内。（与上句话一致，表达方式不同）")])]),t._v(" "),a("li",[a("p",[t._v("简单的说这个逻辑链条就是:@SpringbootTest去找@SpringbootApplication,@SpringbootApplication注解又包含了SpringBootConfiguration注解。")])]),t._v(" "),a("li",[a("p",[t._v("如果你需要一个跟生产代码不一样的应用配置，考虑使用自定义springbootapplication启动类。")])])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootTest")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("classes "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" CustomApplication"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("CustomApplicationTest")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("ul",[a("li",[t._v("允许properties自定义环境变量")]),t._v(" "),a("li",[t._v("允许从启动参数中定义配置属性")]),t._v(" "),a("li",[t._v("提供不同的webEnvironment模式，可以在指定或者随机端口启动运行web server。注册一个TestRestTemplate或者webTestClient用于完整测试webserver。")])]),t._v(" "),a("p",[t._v("由于@SpringBootTest会完整的启动应用，建议在集成测试后考虑使用。")]),t._v(" "),a("h3",{attrs:{id:"testpropertysource"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#testpropertysource","aria-hidden":"true"}},[t._v("#")]),t._v(" @TestPropertySource")]),t._v(" "),a("p",[t._v("指定测试用例要使用的配置，如果不同的测试用例有不同的测试，那么可以使用这个注解把配置加载到ApplicationContext中。\n例如：")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@TestPropertySource")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"classpath:application.properties"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v('如果没有指定location,那么默认搜索类名关联的配置进行加载。\n如果使用注解测测试类是 is com.example.MyTest, 相应的配置文件就是 "classpath:com/example/MyTest.properties". 如果没有找到默认配置，则抛出IllegalStateException异常。')]),t._v(" "),a("h3",{attrs:{id:"contextconfiguration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contextconfiguration","aria-hidden":"true"}},[t._v("#")]),t._v(" @ContextConfiguration")]),t._v(" "),a("p",[t._v('加载配置类。如果使用了SpringBootTest，这个注解是不需要的。当你需要Spring容器，又不希望加载全部的类时候，可以考虑用@ContextConfiguration指定加载。某种程度上来说@SpringBootTest(classes=""）与@ContextConfiguration(classes="")是等价的。')]),t._v(" "),a("h3",{attrs:{id:"import"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#import","aria-hidden":"true"}},[t._v("#")]),t._v(" @Import")]),t._v(" "),a("p",[t._v("@Import与@ContextConfiguration是完全不同的使用场景。不建议互换（有时也不能互换）。\n@Import用于一个配置类中，导入其他配置类。例如：")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Import")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("PersistenceConfig"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("MainConfig")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("比如你禁用了一个包的component scan，那么但是你需要那个包中的一个配置类的时候，你可以考虑用@Import。")]),t._v(" "),a("p",[t._v("@ContextConfiguration只能用于spring测试。")]),t._v(" "),a("h3",{attrs:{id:"runwith-springrunner-class"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#runwith-springrunner-class","aria-hidden":"true"}},[t._v("#")]),t._v(" @RunWith(SpringRunner.class)")]),t._v(" "),a("p",[t._v("SpringRunner是SpringJUnit4ClassRunner的别名，所以@RunWith(SpringRunner.class)\n@RunWith(SpringJUnit4ClassRunner)是等价的。")]),t._v(" "),a("h2",{attrs:{id:"junit注解（junit4）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#junit注解（junit4）","aria-hidden":"true"}},[t._v("#")]),t._v(" Junit注解（Junit4）")]),t._v(" "),a("p",[t._v("Junit注解参考Junit说明即可。")]),t._v(" "),a("h3",{attrs:{id:"test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test","aria-hidden":"true"}},[t._v("#")]),t._v(" Test")]),t._v(" "),a("h3",{attrs:{id:"before"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#before","aria-hidden":"true"}},[t._v("#")]),t._v(" Before")]),t._v(" "),a("h3",{attrs:{id:"after"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#after","aria-hidden":"true"}},[t._v("#")]),t._v(" After")]),t._v(" "),a("h3",{attrs:{id:"beforeclass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#beforeclass","aria-hidden":"true"}},[t._v("#")]),t._v(" BeforeClass")]),t._v(" "),a("h3",{attrs:{id:"afterclass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#afterclass","aria-hidden":"true"}},[t._v("#")]),t._v(" AfterClass")]),t._v(" "),a("h2",{attrs:{id:"junit5注解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#junit5注解","aria-hidden":"true"}},[t._v("#")]),t._v(" Junit5注解")]),t._v(" "),a("h2",{attrs:{id:"测试建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试建议","aria-hidden":"true"}},[t._v("#")]),t._v(" 测试建议")]),t._v(" "),a("h3",{attrs:{id:"单元测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单元测试","aria-hidden":"true"}},[t._v("#")]),t._v(" 单元测试")]),t._v(" "),a("p",[t._v("重点说三遍：")]),t._v(" "),a("ul",[a("li",[t._v("单元测试不要启动容器。")]),t._v(" "),a("li",[t._v("单元测试不要启动容器。")]),t._v(" "),a("li",[t._v("单元测试不要启动容器。")]),t._v(" "),a("li",[t._v("dao和service根据情况进行单元测试。如果service仅是返回dao的结果，那么可以仅对dao做单元测试。")]),t._v(" "),a("li",[t._v("如果service有业务逻辑，那么建议做单元测试。")]),t._v(" "),a("li",[t._v("对于DAO和Service的测试尽可能不要启动容器，freshal-test已经提供了不启动容器的测试mybatis dao测试支持")]),t._v(" "),a("li",[t._v("对于service的测试，应该使用mock对象，mock dao层。\n例如：")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@RunWith")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MockitoJUnitRunner"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("TodoListServiceTest")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@InjectMocks")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" ToDoService toDoService"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Mock")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" TodoListDao mockDao"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("findAllTest")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" Exception "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        List"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ToDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" toDoList "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ToDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        toDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ToDoList")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("L"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token string"}},[t._v('"jogging at 6:00"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        toDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ToDoList")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v("L"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token string"}},[t._v('"meeting at 10:00"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("when")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mockDao"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("findAll")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("thenReturn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("toDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        List"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ToDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" toDoList2 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" toDoService"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("findAll")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("verify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mockDao"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("findAll")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("assertThat")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("toDoList2"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("hasSize")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("countTest")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("when")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mockDao"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("count")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("thenReturn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" count "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" toDoService"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("count")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("verify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mockDao"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("count")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("assertThat")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("isEqualTo")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v("L"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br")])]),a("p",[t._v("使用mokcito时，测试用例中verify和assert应该都有。verify确保mock的方法被调用。")]),t._v(" "),a("ul",[a("li",[t._v("对于controller层，可以不写单元测试用例，因为集成测试用例也要覆盖到controller层。")]),t._v(" "),a("li",[t._v("如果controller层进行单元测试,请使用MockMvc，例如：")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@RunWith")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MockitoJUnitRunner"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("TodoListControllerStandaloneTest")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    MockMvc mockMvc"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Mock")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" ToDoService toDoService"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@InjectMocks")]),t._v("\n    ToDoListController toDoListController"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Before")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("setup")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        JacksonTester"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("initFields")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ObjectMapper")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// MockMvc standalone approach")]),t._v("\n        mockMvc "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" MockMvcBuilders"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("standaloneSetup")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("toDoListController"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("build")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("getAllToDos")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" Exception "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        List"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ToDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" toDoList "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ToDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        toDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ToDoList")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("L"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token string"}},[t._v('"jogging at 6:00"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        toDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ToDoList")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v("L"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token string"}},[t._v('"meeting at 10:00"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("when")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("toDoService"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("findAll")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("thenReturn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("toDoList"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        mockMvc"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("perform")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"/todos"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("contentType")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MediaType"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("APPLICATION_JSON"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("andExpect")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function"}},[t._v("jsonPath")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"$"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token function"}},[t._v("hasSize")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("andDo")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function"}},[t._v("print")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("verify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("toDoService"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("findAll")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br")])]),a("p",[t._v("关于controller测试更多的内容可以参考：https://github.com/mechero/spring-boot-testing-strategies")]),t._v(" "),a("h3",{attrs:{id:"集成测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集成测试","aria-hidden":"true"}},[t._v("#")]),t._v(" 集成测试")]),t._v(" "),a("ul",[a("li",[t._v("把@SpringBootTest注解用于集成测试。")]),t._v(" "),a("li",[t._v("如果要进行web测试，使用@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)")])]),t._v(" "),a("h2",{attrs:{id:"编写测试用例的原则（f-i-r-s-t-principles-）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写测试用例的原则（f-i-r-s-t-principles-）","aria-hidden":"true"}},[t._v("#")]),t._v(" 编写测试用例的原则（F.I.R.S.T. principles:）")]),t._v(" "),a("p",[t._v("https://www.appsdeveloperblog.com/the-first-principle-in-unit-testing/")]),t._v(" "),a("ul",[a("li",[t._v("F - Fast")]),t._v(" "),a("li",[t._v("I - Independent")]),t._v(" "),a("li",[t._v("R - Repeatable")]),t._v(" "),a("li",[t._v("S - Self-Validating")]),t._v(" "),a("li",[t._v("T - Timely")])]),t._v(" "),a("h2",{attrs:{id:"实践建议："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实践建议：","aria-hidden":"true"}},[t._v("#")]),t._v(" 实践建议：")]),t._v(" "),a("p",[t._v("所以，我们总结一下几个关于springboot测试的实践")]),t._v(" "),a("ul",[a("li",[t._v("除了集成测试，避免加载所有的组件。测试什么，加载什么。最好测试用例仅有@Test注解。")]),t._v(" "),a("li",[t._v("使用Mockito 模拟对象。")]),t._v(" "),a("li",[t._v("仅加载功能相关的部分。例如不可避免要使用@SpringBootTest测试，那么考虑使用"),a("code",[t._v("@SpringBootTest(classes = ABC.class)")]),t._v("这种方式")]),t._v(" "),a("li",[t._v("RestApi一定要进行集成测试")]),t._v(" "),a("li",[t._v("如果使用了JPA，那么用@DataJpaTest注解测试DAO.")]),t._v(" "),a("li",[t._v("分层测试")]),t._v(" "),a("li",[t._v("使用@Suite.SuiteClasses组织集成测试套件。比如入库组织一个，出库组织一个属于不同的测试套件。")])])])}],!1,null,null,null);o.options.__file="SprintbootTesting2.md";s.default=o.exports}}]);