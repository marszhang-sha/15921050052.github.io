<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mvel | 油腻中年大叔</title>
    <meta name="description" content="你想要的这里都没有，你不想要的这里都有">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/assets/css/styles.7863e8ac.css" as="style"><link rel="preload" href="/assets/js/app.7863e8ac.js" as="script"><link rel="preload" href="/assets/js/75.4516323c.js" as="script"><link rel="prefetch" href="/assets/js/0.eb7108e7.js"><link rel="prefetch" href="/assets/js/1.d8ec4d72.js"><link rel="prefetch" href="/assets/js/2.28f90b8d.js"><link rel="prefetch" href="/assets/js/3.6001361f.js"><link rel="prefetch" href="/assets/js/4.80c27a58.js"><link rel="prefetch" href="/assets/js/5.2e2f809b.js"><link rel="prefetch" href="/assets/js/6.0d0d8441.js"><link rel="prefetch" href="/assets/js/7.8e4037c3.js"><link rel="prefetch" href="/assets/js/8.5752a787.js"><link rel="prefetch" href="/assets/js/9.8329deb8.js"><link rel="prefetch" href="/assets/js/10.4843c5ba.js"><link rel="prefetch" href="/assets/js/11.9e8b7549.js"><link rel="prefetch" href="/assets/js/12.02c0fa30.js"><link rel="prefetch" href="/assets/js/13.f5d738e8.js"><link rel="prefetch" href="/assets/js/14.ca4b3249.js"><link rel="prefetch" href="/assets/js/15.cf61b2ec.js"><link rel="prefetch" href="/assets/js/16.2b67aa0e.js"><link rel="prefetch" href="/assets/js/17.b99a459f.js"><link rel="prefetch" href="/assets/js/18.2d5afa9a.js"><link rel="prefetch" href="/assets/js/19.6c36dff4.js"><link rel="prefetch" href="/assets/js/20.3e0dc870.js"><link rel="prefetch" href="/assets/js/21.227ee5ec.js"><link rel="prefetch" href="/assets/js/22.05c1f0f0.js"><link rel="prefetch" href="/assets/js/23.c6dbeed0.js"><link rel="prefetch" href="/assets/js/24.957b4252.js"><link rel="prefetch" href="/assets/js/25.b50e4879.js"><link rel="prefetch" href="/assets/js/26.1b2b16cf.js"><link rel="prefetch" href="/assets/js/27.2f0f5e4c.js"><link rel="prefetch" href="/assets/js/28.ffafaa79.js"><link rel="prefetch" href="/assets/js/29.38ab4732.js"><link rel="prefetch" href="/assets/js/30.7258c2eb.js"><link rel="prefetch" href="/assets/js/31.6cc6f25e.js"><link rel="prefetch" href="/assets/js/32.cae8f5c2.js"><link rel="prefetch" href="/assets/js/33.7bac5900.js"><link rel="prefetch" href="/assets/js/34.e457a7ab.js"><link rel="prefetch" href="/assets/js/35.6a4f99be.js"><link rel="prefetch" href="/assets/js/36.3fa7b425.js"><link rel="prefetch" href="/assets/js/37.9627a576.js"><link rel="prefetch" href="/assets/js/38.8f902270.js"><link rel="prefetch" href="/assets/js/39.2fb6b1fd.js"><link rel="prefetch" href="/assets/js/40.0f992849.js"><link rel="prefetch" href="/assets/js/41.1921a30c.js"><link rel="prefetch" href="/assets/js/42.196053b0.js"><link rel="prefetch" href="/assets/js/43.6a2cc6b2.js"><link rel="prefetch" href="/assets/js/44.c3b31b69.js"><link rel="prefetch" href="/assets/js/45.dd90e897.js"><link rel="prefetch" href="/assets/js/46.547a7ce9.js"><link rel="prefetch" href="/assets/js/47.a62be284.js"><link rel="prefetch" href="/assets/js/48.edc6618c.js"><link rel="prefetch" href="/assets/js/49.b3d5118e.js"><link rel="prefetch" href="/assets/js/50.81540475.js"><link rel="prefetch" href="/assets/js/51.c2c1171b.js"><link rel="prefetch" href="/assets/js/52.ba318094.js"><link rel="prefetch" href="/assets/js/53.a2d5d15e.js"><link rel="prefetch" href="/assets/js/54.3608cfdf.js"><link rel="prefetch" href="/assets/js/55.73c0d459.js"><link rel="prefetch" href="/assets/js/56.9706fe8c.js"><link rel="prefetch" href="/assets/js/57.f5a08e9a.js"><link rel="prefetch" href="/assets/js/58.ea9c9ad0.js"><link rel="prefetch" href="/assets/js/59.9d363669.js"><link rel="prefetch" href="/assets/js/60.8a80b28f.js"><link rel="prefetch" href="/assets/js/61.73e5c6a8.js"><link rel="prefetch" href="/assets/js/62.30aab875.js"><link rel="prefetch" href="/assets/js/63.1e86c5c0.js"><link rel="prefetch" href="/assets/js/64.9c071a1e.js"><link rel="prefetch" href="/assets/js/65.61d8d11c.js"><link rel="prefetch" href="/assets/js/66.dd39544e.js"><link rel="prefetch" href="/assets/js/67.6dd79cd2.js"><link rel="prefetch" href="/assets/js/68.dd07b2a3.js"><link rel="prefetch" href="/assets/js/69.a5a81dbc.js"><link rel="prefetch" href="/assets/js/70.3f26faed.js"><link rel="prefetch" href="/assets/js/71.1234830b.js"><link rel="prefetch" href="/assets/js/72.d4db7f16.js"><link rel="prefetch" href="/assets/js/73.e2b0a283.js"><link rel="prefetch" href="/assets/js/74.db6d3ebc.js"><link rel="prefetch" href="/assets/js/76.a086fd94.js"><link rel="prefetch" href="/assets/js/77.165f6d28.js"><link rel="prefetch" href="/assets/js/78.81cd058e.js"><link rel="prefetch" href="/assets/js/79.fde8c00b.js"><link rel="prefetch" href="/assets/js/80.142b728c.js"><link rel="prefetch" href="/assets/js/81.367c9c5e.js"><link rel="prefetch" href="/assets/js/82.d23176e0.js"><link rel="prefetch" href="/assets/js/83.d9571f6f.js"><link rel="prefetch" href="/assets/js/84.6214056c.js"><link rel="prefetch" href="/assets/js/85.66cc6092.js"><link rel="prefetch" href="/assets/js/86.18dba812.js"><link rel="prefetch" href="/assets/js/87.9506d9f8.js"><link rel="prefetch" href="/assets/js/88.b42d6720.js"><link rel="prefetch" href="/assets/js/89.5c0033c4.js"><link rel="prefetch" href="/assets/js/90.069a50d4.js"><link rel="prefetch" href="/assets/js/91.61fe3c31.js"><link rel="prefetch" href="/assets/js/92.e4211585.js"><link rel="prefetch" href="/assets/js/93.6df74471.js"><link rel="prefetch" href="/assets/js/94.d61ebe6e.js"><link rel="prefetch" href="/assets/js/95.c60c8a69.js"><link rel="prefetch" href="/assets/js/96.e3124488.js"><link rel="prefetch" href="/assets/js/97.bce37e32.js"><link rel="prefetch" href="/assets/js/98.a1fb95ac.js"><link rel="prefetch" href="/assets/js/99.f9c12b84.js"><link rel="prefetch" href="/assets/js/100.0b3aaca9.js"><link rel="prefetch" href="/assets/js/101.03f32ae7.js"><link rel="prefetch" href="/assets/js/102.69cca032.js"><link rel="prefetch" href="/assets/js/103.190dc3ef.js"><link rel="prefetch" href="/assets/js/104.6e7ceda7.js"><link rel="prefetch" href="/assets/js/105.f852f5a7.js"><link rel="prefetch" href="/assets/js/106.9335f238.js"><link rel="prefetch" href="/assets/js/107.1404f516.js"><link rel="prefetch" href="/assets/js/108.dd6bb5e3.js"><link rel="prefetch" href="/assets/js/109.a87f5640.js"><link rel="prefetch" href="/assets/js/110.fb0da049.js"><link rel="prefetch" href="/assets/js/111.cc64ddd7.js"><link rel="prefetch" href="/assets/css/112.styles.75c39ee5.css"><link rel="prefetch" href="/assets/js/112.75c39ee5.js"><link rel="prefetch" href="/assets/css/113.styles.407e8d7f.css"><link rel="prefetch" href="/assets/js/113.407e8d7f.js">
    <link rel="stylesheet" href="/assets/css/112.styles.75c39ee5.css"><link rel="stylesheet" href="/assets/css/113.styles.407e8d7f.css"><link rel="stylesheet" href="/assets/css/styles.7863e8ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">油腻中年大叔</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link router-link-active">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/rubik/" class="nav-link">魔方</a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link router-link-active">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/rubik/" class="nav-link">魔方</a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/drools/drools.html" class="sidebar-link">Drools简介</a></li><li><a href="/drools/runtime.html" class="sidebar-link">Drools Runtime</a></li><li><a href="/drools/kie.html" class="sidebar-link">KIE简介</a></li><li><a href="/drools/kie-api.html" class="sidebar-link">KIE API简介</a></li><li><a href="/drools/mvel.html" class="active sidebar-link">mvel语法举例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/drools/mvel.html#facts-used-during-course" class="sidebar-link">Facts used during course</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/drools/mvel.html#emp" class="sidebar-link">Emp</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#dept" class="sidebar-link">Dept</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#salgrade" class="sidebar-link">Salgrade</a></li></ul></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#filtering" class="sidebar-link">Filtering</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/drools/mvel.html#根据fact-type过滤" class="sidebar-link">根据Fact Type过滤</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#根据field过滤" class="sidebar-link">根据field过滤</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#operators-操作符" class="sidebar-link">Operators 操作符</a></li></ul></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#从多个fact-types中选择数据" class="sidebar-link">从多个Fact Types中选择数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/drools/mvel.html#笛卡儿积-直积" class="sidebar-link">笛卡儿积 (直积)</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#只选择那些在两个fact-types中都匹配deptno的数据" class="sidebar-link">只选择那些在两个fact types中都匹配deptno的数据</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#寻找员工姓名和工资等级" class="sidebar-link">寻找员工姓名和工资等级</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#更加复杂的例子" class="sidebar-link">更加复杂的例子</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#搜索特别事实" class="sidebar-link">搜索特别事实</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#寻找同一类型的facts" class="sidebar-link">寻找同一类型的facts</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#累计函数" class="sidebar-link">累计函数</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#groups-组" class="sidebar-link">Groups 组</a></li><li class="sidebar-sub-header"><a href="/drools/mvel.html#collect-functions" class="sidebar-link">Collect Functions</a></li></ul></li></ul></li><li><a href="/drools/kie-customize.html" class="sidebar-link">Customize KIE</a></li><li><a href="/drools/springboot.html" class="sidebar-link">SpringBoot Kie Server</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="mvel"><a href="#mvel" aria-hidden="true" class="header-anchor">#</a> Mvel</h1> <h2 id="facts-used-during-course"><a href="#facts-used-during-course" aria-hidden="true" class="header-anchor">#</a> Facts used during course</h2> <h3 id="emp"><a href="#emp" aria-hidden="true" class="header-anchor">#</a> Emp</h3> <table><thead><tr><th>id</th> <th>name</th> <th>job</th> <th>mgr</th> <th>hiredate</th> <th>sal</th> <th>deptno</th></tr></thead> <tbody><tr><td>7839</td> <td>BUSH</td> <td>PRESIDENT</td> <td>0</td> <td>1981</td> <td>5000.00</td> <td>10</td></tr> <tr><td>7698</td> <td>BLAIR</td> <td>MANAGER</td> <td>7839</td> <td>1981</td> <td>2850.00</td> <td>30</td></tr> <tr><td>7782</td> <td>MERKEL</td> <td>MANAGER</td> <td>7839</td> <td>1981</td> <td>2450.00</td> <td>10</td></tr> <tr><td>7566</td> <td>PUTIN</td> <td>MANAGER</td> <td>7839</td> <td>1981</td> <td>2975.00</td> <td>20</td></tr> <tr><td>7654</td> <td>CHIRACK</td> <td>SALESMAN</td> <td>7698</td> <td>1981</td> <td>1250.00</td> <td>30</td></tr> <tr><td>7499</td> <td>BAROSSO</td> <td>SALESMAN</td> <td>7698</td> <td>1981</td> <td>1600.00</td> <td>30</td></tr> <tr><td>7844</td> <td>GATES</td> <td>SALESMAN</td> <td>7698</td> <td>1981</td> <td>1500.00</td> <td>30</td></tr> <tr><td>7900</td> <td>BUFFETT</td> <td>CLERK</td> <td>7698</td> <td>1981</td> <td>950.00</td> <td>30</td></tr> <tr><td>7521</td> <td>WALTON</td> <td>SALESMAN</td> <td>7698</td> <td>1981</td> <td>1250.00</td> <td>30</td></tr> <tr><td>7902</td> <td>TOOSK</td> <td>ANALYST</td> <td>7566</td> <td>1981</td> <td>3000.00</td> <td>20</td></tr> <tr><td>7369</td> <td>THATCHER</td> <td>CLERK</td> <td>7902</td> <td>1980</td> <td>800.00</td> <td>20</td></tr> <tr><td>7788</td> <td>CARNEGIE</td> <td>ANALYST</td> <td>7566</td> <td>1982</td> <td>3000.00</td> <td>20</td></tr> <tr><td>7876</td> <td>FORD</td> <td>CLERK</td> <td>7788</td> <td>1983</td> <td>1100.00</td> <td>20</td></tr> <tr><td>7934</td> <td>ELISON</td> <td>CLERK</td> <td>7782</td> <td>1982</td> <td>1300.00</td> <td>10</td></tr></tbody></table> <h3 id="dept"><a href="#dept" aria-hidden="true" class="header-anchor">#</a> Dept</h3> <table><thead><tr><th>deptno</th> <th>dname</th> <th>loc</th></tr></thead> <tbody><tr><td>10</td> <td>ACCOUNTING</td> <td>NEW YORK</td></tr> <tr><td>20</td> <td>RESEARCH</td> <td>LONDON</td></tr> <tr><td>30</td> <td>SALES</td> <td>PARIS</td></tr> <tr><td>40</td> <td>OPERATIONS</td> <td>BERLIN</td></tr></tbody></table> <h3 id="salgrade"><a href="#salgrade" aria-hidden="true" class="header-anchor">#</a> Salgrade</h3> <p>+-------+-------+-------+
| grade | losal | hisal |
+-------+-------+-------+
| 1     | 700   | 1200  |
| 2     | 1201  | 1400  |
| 3     | 1401  | 2000  |
| 4     | 2001  | 3000  |
| 5     | 3001  | 9999  |
+-------+-------+-------+</p> <h2 id="filtering"><a href="#filtering" aria-hidden="true" class="header-anchor">#</a> Filtering</h2> <h3 id="根据fact-type过滤"><a href="#根据fact-type过滤" aria-hidden="true" class="header-anchor">#</a> 根据Fact Type过滤</h3> <h4 id="find-all-facts-of-emp-type"><a href="#find-all-facts-of-emp-type" aria-hidden="true" class="header-anchor">#</a> Find all facts of Emp type</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
	e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
then    
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
       e<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> 
       e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> 
       e<span class="token punctuation">.</span>job <span class="token operator">+</span> <span class="token string">&quot;   \t&quot;</span> <span class="token operator">+</span>
       e<span class="token punctuation">.</span>mgr  <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span>
       e<span class="token punctuation">.</span>hiredate <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> 
       e<span class="token punctuation">.</span>sal <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> 
       e<span class="token punctuation">.</span>deptno <span class="token punctuation">)</span><span class="token punctuation">;</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="根据field过滤"><a href="#根据field过滤" aria-hidden="true" class="header-anchor">#</a> 根据field过滤</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;</span> <span class="token number">1500</span><span class="token punctuation">)</span>
then    
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>job  
    <span class="token operator">+</span> <span class="token string">&quot;   \t&quot;</span> <span class="token operator">+</span>  e<span class="token punctuation">.</span>mgr  <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>hiredate <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>sal
     <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>deptno <span class="token punctuation">)</span><span class="token punctuation">;</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="operators-操作符"><a href="#operators-操作符" aria-hidden="true" class="header-anchor">#</a> Operators 操作符</h3> <p>操作符有很多种类:</p> <ul><li>Arithmetic operators (+, -, *, /, %) 算数操作符</li> <li>Relational operators (&gt;, &gt;=, ==, !=) 关系操作符</li> <li>Logical operators 逻辑操作符</li> <li>conjunction (and, &amp;&amp;, &quot;,&quot;) 与</li> <li>disjunction (or, ||) 或</li> <li>negation (!, do not confuse with not) 取反 (!, 不要和 not 混淆)</li> <li>Drools operators (in, matches, etc...) | Drools 操作符 (in, matches, 等等...)</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>$e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;</span> <span class="token number">1500</span><span class="token punctuation">,</span> deptno <span class="token operator">==</span> <span class="token number">10</span> <span class="token operator">||</span> deptno <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span> 
$e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;</span> <span class="token number">1500</span> <span class="token operator">&amp;&amp;</span> deptno <span class="token operator">==</span> <span class="token number">10</span> <span class="token operator">||</span> deptno <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="relational-operators-关系操作符"><a href="#relational-operators-关系操作符" aria-hidden="true" class="header-anchor">#</a> Relational Operators 关系操作符 &quot;=&quot;&quot;</h4> <p><strong>搜索 managers</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
   e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">==</span> <span class="token string">&quot;MANAGER&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7566 PUTIN	MANAGER   	7839	1981 2975 20
7782 MERKEL	MANAGER   	7839	1981 2450 10
7698 BLAIR	MANAGER   	7839	1981 2850 30
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>1982雇佣的人</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
   e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>hiredate <span class="token operator">==</span> <span class="token number">1982</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7934 ELISON	CLERK   	7782	1982 1300 10
7788 CARNEGIE	ANALYST   	7566	1982 3000 20
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>选择除了clerks之外的所有人.</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">!=</span> <span class="token string">'CLERK'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7788 CARNEGIE	ANALYST   	7566	1982 3000 20
7902 TOOSK	ANALYST   	7566	1981 3000 20
7521 WALTON	SALESMAN   	7698	1981 1250 30
7844 GATES	SALESMAN   	7698	1981 1500 30
7499 BAROSSO	SALESMAN   	7698	1981 1600 30
7654 CHIRACK	SALESMAN   	7698	1981 1250 30
7566 PUTIN	MANAGER   	7839	1981 2975 20
7782 MERKEL	MANAGER   	7839	1981 2450 10
7698 BLAIR	MANAGER   	7839	1981 2850 30
7839 BUSH	PRESIDENT   	0	1981 5000 10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>选择收入在1000和2000之间的人 (inclusive)</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;=</span> <span class="token number">1000</span> <span class="token punctuation">,</span> sal <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7934 ELISON	CLERK   	7782	1982 1300 10
7876 FORD	CLERK   	7788	1983 1100 20
7521 WALTON	SALESMAN   	7698	1981 1250 30
7844 GATES	SALESMAN   	7698	1981 1500 30
7499 BAROSSO	SALESMAN   	7698	1981 1600 30
7654 CHIRACK	SALESMAN   	7698	1981 1250 30
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>下面所有语句功能一样</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;=</span> <span class="token number">1000</span> <span class="token punctuation">,</span> sal <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;=</span> <span class="token number">1000</span> <span class="token operator">&amp;&amp;</span> sal  <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;=</span> <span class="token number">1000</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="in-operator-操作符"><a href="#in-operator-操作符" aria-hidden="true" class="header-anchor">#</a> &quot;in&quot; operator 操作符</h4> <p>in 操作符检查值是否存在于某个集合内
<strong>选择在No.10 或者No.20部门工作的人</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>deptno in <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7934 ELISON	CLERK   	7782	1982 1300 10
7876 FORD	CLERK   	7788	1983 1100 20
7788 CARNEGIE	ANALYST   	7566	1982 3000 20
7369 THATCHER	CLERK   	7902	1980 800 20
7902 TOOSK	ANALYST   	7566	1981 3000 20
7566 PUTIN	MANAGER   	7839	1981 2975 20
7782 MERKEL	MANAGER   	7839	1981 2450 10
7839 BUSH	PRESIDENT   	0	1981 5000 10

``<span class="token variable"><span class="token variable">`</span><span class="token function">bash</span>
上面的语句也可以写成
<span class="token variable">`</span></span>``java
 e <span class="token keyword">:</span> Emp<span class="token punctuation">(</span>deptno <span class="token operator">==</span> 10 <span class="token operator">||</span> deptno <span class="token operator">==</span> 20<span class="token punctuation">)</span>
 e <span class="token keyword">:</span> <span class="token punctuation">(</span>Emp<span class="token punctuation">(</span>deptno <span class="token operator">==</span> 10<span class="token punctuation">)</span> or Emp<span class="token punctuation">(</span>deptno <span class="token operator">==</span> 20<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Drools引擎对上两行的评估方式完全不同
关键字or 会将规则分割成两个规则
详情请看 RETE TREE 的举例说明!</p> <p><strong>选择 managers 或者 clerks.</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>job in <span class="token punctuation">(</span><span class="token string">'CLERK'</span><span class="token punctuation">,</span><span class="token string">'MANAGER'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7934 ELISON	CLERK   	7782	1982 1300 10
7876 FORD	CLERK   	7788	1983 1100 20
7369 THATCHER	CLERK   	7902	1980 800 20 
7900 BUFFETT	CLERK   	7698	1981 950 30
7566 PUTIN	MANAGER   	7839	1981 2975 20
7782 MERKEL	MANAGER   	7839	1981 2450 10
7698 BLAIR	MANAGER   	7839	1981 2850 30
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="matches-操作符"><a href="#matches-操作符" aria-hidden="true" class="header-anchor">#</a> matches 操作符</h4> <p>'maches' 操作符检查值是否与模式匹配 (java 正则表达式).</p> <ul><li>匹配一个单一字符</li> <li>匹配任何字符, 包括空（没有）字符.
More information: http://docs.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html</li></ul> <p><strong>选择名字以 &quot;B&quot; 开头的人.</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
    e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>name matches <span class="token string">&quot;B.*&quot;</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7900 BUFFETT	CLERK   	7698	1981 950 30
7499 BAROSSO	SALESMAN   	7698	1981 1600 30
7698 BLAIR	MANAGER   	7839	1981 2850 30
7839 BUSH	PRESIDENT   	0	1981 5000 10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>选择名字的第二个字符是‘a’的人</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
    e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>name matches <span class="token string">&quot;.A.*&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7788 CARNEGIE	ANALYST   	7566	1982 3000 20
7521 WALTON	SALESMAN   	7698	1981 1250 30
7844 GATES	SALESMAN   	7698	1981 1500 30
7499 BAROSSO	SALESMAN   	7698	1981 1600 30
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>not matches 操作符</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> when
    e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>name not matches <span class="token string">&quot;B.*&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样写语法是不正确的：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> when
    e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>name <span class="token operator">!</span> matches <span class="token string">&quot;B.*&quot;</span><span class="token punctuation">)</span>
    e<span class="token operator">:</span> <span class="token operator">!</span> <span class="token function">Emp</span><span class="token punctuation">(</span>name matches <span class="token string">&quot;B.*&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>组合条件</strong>
你可以使用逻辑操作符书写组合条件</p> <ul><li>&quot;and&quot;, &quot;&amp;&amp;&quot;, &quot;,&quot; (conjunction) (与)</li> <li>&quot;or&quot;, &quot;||&quot;	(disjunction) (或)</li> <li>&quot;not&quot;, &quot;!&quot;	(negation) (反)
Examples
<strong>搜索收入高于2500的managers</strong></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
    e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">==</span> <span class="token string">&quot;MANAGER&quot;</span> <span class="token punctuation">,</span> sal <span class="token operator">&gt;</span> <span class="token number">2500</span><span class="token punctuation">)</span> 
<span class="token number">7566</span> PUTIN	MANAGER   	<span class="token number">7839</span>	<span class="token number">1981</span> <span class="token number">2975</span> <span class="token number">20</span>
<span class="token number">7698</span> BLAIR	MANAGER   	<span class="token number">7839</span>	<span class="token number">1981</span> <span class="token number">2850</span> <span class="token number">30</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>下面的语句运行结果一致</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
    e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">==</span> <span class="token string">&quot;MANAGER&quot;</span> <span class="token operator">&amp;&amp;</span> sal <span class="token operator">&gt;</span> <span class="token number">2500</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意 &quot;,&quot; 和 &quot;&amp;&amp;&quot; 优先级不同</p> <p><strong>Operators priority 操作符优先级</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>(nested) property access    .	
List/Map access            [ ]	
constraint binding   :	
multiplicative       * / %	 
additive             + -	 
shift                &lt;&lt; &gt;&gt; &gt;&gt;&gt;	 
relational           &lt; &gt; &lt;= &gt;= instanceof	 
equality             == !=	
bit-wise non-short circuiting AND               &amp;	 
bit-wise non-short circuiting exclusive OR	^	 
bit-wise non-short circuiting inclusive OR	|	 
logical AND	&amp;&amp;	 
logical OR	||	 
ternary	? :	 
Comma separated AND	,
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="从多个fact-types中选择数据"><a href="#从多个fact-types中选择数据" aria-hidden="true" class="header-anchor">#</a> 从多个Fact Types中选择数据</h2> <h3 id="笛卡儿积-直积"><a href="#笛卡儿积-直积" aria-hidden="true" class="header-anchor">#</a> 笛卡儿积 (直积)</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
   d <span class="token operator">:</span><span class="token function">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> d<span class="token punctuation">.</span>dname<span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ELISON	OPERATIONS
ELISON	SALES
ELISON	RESEARCH
ELISON	ACCOUNTING
FORD	OPERATIONS
FORD	SALES
FORD	RESEARCH
FORD	ACCOUNTING
<span class="token punctuation">..</span>.
BUSH	OPERATIONS
BUSH	SALES
BUSH	RESEARCH
BUSH	ACCOUNTING
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>about this cross product ,refer:https://docs.jboss.org/drools/release/7.14.0.Final/drools-docs/html_single/#_cross_products</p> <h3 id="只选择那些在两个fact-types中都匹配deptno的数据"><a href="#只选择那些在两个fact-types中都匹配deptno的数据" aria-hidden="true" class="header-anchor">#</a> 只选择那些在两个fact types中都匹配deptno的数据</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
  d <span class="token operator">:</span><span class="token function">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>deptno <span class="token operator">==</span> deptno<span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> d<span class="token punctuation">.</span>dname<span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ELISON	ACCOUNTING
FORD	RESEARCH
CARNEGIE	RESEARCH
THATCHER	RESEARCH
TOOSK	RESEARCH
WALTON	SALES
BUFFETT	SALES
GATES	SALES
BAROSSO	SALES
CHIRACK	SALES
PUTIN	RESEARCH
MERKEL	ACCOUNTING
BLAIR	SALES
BUSH	ACCOUNTING
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="寻找员工姓名和工资等级"><a href="#寻找员工姓名和工资等级" aria-hidden="true" class="header-anchor">#</a> 寻找员工姓名和工资等级</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
   s <span class="token operator">:</span><span class="token function">Salgrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;=</span> s<span class="token punctuation">.</span>losal <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;=</span> s<span class="token punctuation">.</span>hisal<span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span>grade<span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ELISON	2
FORD	1
CARNEGIE	4
THATCHER	1
TOOSK	4
WALTON	2
BUFFETT	1
GATES	3
BAROSSO	3
CHIRACK	2
PUTIN	4
MERKEL	4
BLAIR	4
BUSH	5
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="更加复杂的例子"><a href="#更加复杂的例子" aria-hidden="true" class="header-anchor">#</a> 更加复杂的例子</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
   s <span class="token operator">:</span><span class="token function">Salgrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   d <span class="token operator">:</span><span class="token function">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;=</span> s<span class="token punctuation">.</span>losal <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;=</span> s<span class="token punctuation">.</span>hisal<span class="token punctuation">,</span> d<span class="token punctuation">.</span>deptno <span class="token operator">==</span> deptno<span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span>grade <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> d<span class="token punctuation">.</span>dname <span class="token punctuation">)</span>
end

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ELISON	2	ACCOUNTING
FORD	1	RESEARCH
CARNEGIE	4	RESEARCH
THATCHER	1	RESEARCH
TOOSK	4	RESEARCH
WALTON	2	SALES
BUFFETT	1	SALES
GATES	3	SALES
BAROSSO	3	SALES
CHIRACK	2	SALES
PUTIN	4	RESEARCH
MERKEL	4	ACCOUNTING
BLAIR	4	SALES
BUSH	5	ACCOUNTING
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="搜索特别事实"><a href="#搜索特别事实" aria-hidden="true" class="header-anchor">#</a> 搜索特别事实</h3> <h4 id="寻找有雇员的部门"><a href="#寻找有雇员的部门" aria-hidden="true" class="header-anchor">#</a> 寻找有雇员的部门</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
   d <span class="token operator">:</span><span class="token function">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   exists <span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>deptno <span class="token operator">==</span> d<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> d<span class="token punctuation">.</span>dname <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ACCOUNTING
RESEARCH
SALES
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="寻找没有雇员的部门"><a href="#寻找没有雇员的部门" aria-hidden="true" class="header-anchor">#</a> 寻找没有雇员的部门</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
   d <span class="token operator">:</span><span class="token function">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   not <span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>deptno <span class="token operator">==</span> d<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> d<span class="token punctuation">.</span>dname <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>OPERATIONS
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="寻找同一类型的facts"><a href="#寻找同一类型的facts" aria-hidden="true" class="header-anchor">#</a> 寻找同一类型的facts</h3> <h4 id="一份谁是谁上级的报告"><a href="#一份谁是谁上级的报告" aria-hidden="true" class="header-anchor">#</a> 一份谁是谁上级的报告</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
   e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   m <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>id <span class="token operator">==</span> e<span class="token punctuation">.</span>mgr<span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; reports to &quot;</span> <span class="token operator">+</span> m<span class="token punctuation">.</span>name <span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ELISON reports to MERKEL
FORD reports to CARNEGIE
CARNEGIE reports to PUTIN
THATCHER reports to TOOSK
TOOSK reports to PUTIN
WALTON reports to BLAIR
BUFFETT reports to BLAIR
GATES reports to BLAIR
BAROSSO reports to BLAIR
CHIRACK reports to BLAIR
PUTIN reports to BUSH
MERKEL reports to BUSH
BLAIR reports to BUSH
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="累计函数"><a href="#累计函数" aria-hidden="true" class="header-anchor">#</a> 累计函数</h3> <p>Drools 有一些 累计（accumulate）函数:</p> <ul><li>average</li> <li>min</li> <li>max</li> <li>count</li> <li>sum</li></ul> <h4 id="寻找整个公司的平均工资"><a href="#寻找整个公司的平均工资" aria-hidden="true" class="header-anchor">#</a> 寻找整个公司的平均工资</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  accumulate <span class="token punctuation">(</span>e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> avg <span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span><span class="token punctuation">)</span> 
then    
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>avg<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code> 2073
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>还可以写成:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
   avg<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> from accumulate <span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>s<span class="token operator">:</span> sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">average</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
then    
   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>avg<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>accumulate <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> avg<span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span><span class="token punctuation">)</span>
  e<span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>sal <span class="token operator">&gt;</span>  
    <span class="token punctuation">(</span>Double<span class="token punctuation">)</span>avg
  <span class="token punctuation">)</span>
then
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>sal <span class="token operator">+</span> <span class="token string">&quot; average is &quot;</span>  <span class="token operator">+</span> avg<span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="multi-function-accumulates"><a href="#multi-function-accumulates" aria-hidden="true" class="header-anchor">#</a> Multi-function Accumulates</h4> <p>你可以一次使用多个累计函数:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  accumulate <span class="token punctuation">(</span>e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  	$avg <span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span>
  	$min <span class="token operator">:</span> <span class="token function">min</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span>
  	$max <span class="token operator">:</span> <span class="token function">max</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span>
  	<span class="token punctuation">)</span> 
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
   <span class="token string">&quot;Average salary: &quot;</span> <span class="token operator">+</span> $avg <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;Min salary: &quot;</span> <span class="token operator">+</span> $min <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;Max salary: &quot;</span> <span class="token operator">+</span> $max <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span>
  <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Average salary: 2073.214285714286
Min salary: 800.0
Max salary: 5000.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="groups-组"><a href="#groups-组" aria-hidden="true" class="header-anchor">#</a> Groups 组</h3> <p>一个组包含了属性值相同的facts。
在统计学里也叫做factor levels.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">|</span> CARNEGIE <span class="token operator">|</span> ANALYST   <span class="token operator">|</span> 3000.00 <span class="token operator">|</span>
<span class="token operator">|</span> TOOSK    <span class="token operator">|</span> ANALYST   <span class="token operator">|</span> 3000.00 <span class="token operator">|</span>
<span class="token operator">|</span> ELISON   <span class="token operator">|</span> CLERK     <span class="token operator">|</span> 1300.00 <span class="token operator">|</span>
<span class="token operator">|</span> FORD     <span class="token operator">|</span> CLERK     <span class="token operator">|</span> 1100.00 <span class="token operator">|</span>
<span class="token operator">|</span> THATCHER <span class="token operator">|</span> CLERK     <span class="token operator">|</span> 800.00  <span class="token operator">|</span>
<span class="token operator">|</span> BUFFETT  <span class="token operator">|</span> CLERK     <span class="token operator">|</span> 950.00  <span class="token operator">|</span>
<span class="token operator">|</span> PUTIN    <span class="token operator">|</span> MANAGER   <span class="token operator">|</span> 2975.00 <span class="token operator">|</span>
<span class="token operator">|</span> MERKEL   <span class="token operator">|</span> MANAGER   <span class="token operator">|</span> 2450.00 <span class="token operator">|</span>
<span class="token operator">|</span> BLAIR    <span class="token operator">|</span> MANAGER   <span class="token operator">|</span> 2850.00 <span class="token operator">|</span>
<span class="token operator">|</span> BUSH     <span class="token operator">|</span> PRESIDENT <span class="token operator">|</span> 5000.00 <span class="token operator">|</span>
<span class="token operator">|</span> GATES    <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> 1500.00 <span class="token operator">|</span>
<span class="token operator">|</span> BAROSSO  <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> 1600.00 <span class="token operator">|</span>
<span class="token operator">|</span> WALTON   <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> 1250.00 <span class="token operator">|</span>
<span class="token operator">|</span> CHIRACK  <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> 1250.00 <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这里有五个job组:ANALYST, CLERK, MANAGER, PRESIDENT and SALESMAN.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
  <span class="token function">Emp</span><span class="token punctuation">(</span>j<span class="token operator">:</span> job<span class="token punctuation">)</span> 
  accumulate <span class="token punctuation">(</span>e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span>    	$avg <span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span>  	<span class="token punctuation">)</span> 
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>   <span class="token string">&quot;Average salary in position &quot;</span> <span class="token operator">+</span> j <span class="token operator">+</span> <span class="token string">&quot;is: &quot;</span> <span class="token operator">+</span> $avg <span class="token punctuation">)</span> 
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Average salary <span class="token keyword">in</span> position CLERKis: 1037.5
Average salary <span class="token keyword">in</span> position CLERKis: 1037.5
Average salary <span class="token keyword">in</span> position ANALYSTis: 3000.0
Average salary <span class="token keyword">in</span> position CLERKis: 1037.5
Average salary <span class="token keyword">in</span> position ANALYSTis: 3000.0
Average salary <span class="token keyword">in</span> position SALESMANis: 1400.0
Average salary <span class="token keyword">in</span> position CLERKis: 1037.5
Average salary <span class="token keyword">in</span> position SALESMANis: 1400.0
Average salary <span class="token keyword">in</span> position SALESMANis: 1400.0
Average salary <span class="token keyword">in</span> position SALESMANis: 1400.0
Average salary <span class="token keyword">in</span> position MANAGERis: 2758.3333333333335
Average salary <span class="token keyword">in</span> position MANAGERis: 2758.3333333333335
Average salary <span class="token keyword">in</span> position MANAGERis: 2758.3333333333335
Average salary <span class="token keyword">in</span> position PRESIDENTis: 5000.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="declaring-and-inserting-new-facts-声明和插入新的facts"><a href="#declaring-and-inserting-new-facts-声明和插入新的facts" aria-hidden="true" class="header-anchor">#</a> Declaring and inserting new facts 声明和插入新的facts</h4> <p>上面的解决方法的问题是它重复了 (循环) 14 次 (雇员的数量).</p> <p>要解决这个问题，我们可以标记“已经处理过的组”。我们可以通过“插入一个新的fact SalByJob&quot;实现这个，然后我们检查是否已经计算出了平均值</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>not <span class="token function">SalByJob</span><span class="token punctuation">(</span>j <span class="token operator">==</span> job<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>declare SalByJob
   job <span class="token operator">:</span> String
   avgSal <span class="token operator">:</span> Double
end

rule <span class="token string">&quot;Sample&quot;</span>
when
   <span class="token function">Emp</span><span class="token punctuation">(</span>j<span class="token operator">:</span> job<span class="token punctuation">)</span> and
   not <span class="token function">SalByJob</span><span class="token punctuation">(</span>j <span class="token operator">==</span> job<span class="token punctuation">)</span>
   accumulate <span class="token punctuation">(</span>e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> 	$avg <span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span>   	<span class="token punctuation">)</span> 
then    
   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>   <span class="token string">&quot;Average salary in position &quot;</span> <span class="token operator">+</span> j <span class="token operator">+</span> <span class="token string">&quot;is: &quot;</span> <span class="token operator">+</span> $avg <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token punctuation">)</span>
   <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SalByJob</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>$avg<span class="token punctuation">)</span><span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>declare SalByJob
   job <span class="token operator">:</span> String
end

rule <span class="token string">&quot;Sample&quot;</span>
when
   <span class="token function">Emp</span><span class="token punctuation">(</span>j<span class="token operator">:</span> job<span class="token punctuation">)</span> and
   not <span class="token function">SalByJob</span><span class="token punctuation">(</span>j <span class="token operator">==</span> job<span class="token punctuation">)</span>
   accumulate <span class="token punctuation">(</span>e <span class="token operator">:</span><span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> 	$avg <span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span>   	<span class="token punctuation">)</span> 
then    
   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>   <span class="token string">&quot;Average salary in position &quot;</span> <span class="token operator">+</span> j <span class="token operator">+</span> <span class="token string">&quot;is: &quot;</span> <span class="token operator">+</span> $avg <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token punctuation">)</span>
   <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SalByJob</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
end

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>Average salary in position CLERKis: 1037.5
Average salary in position ANALYSTis: 3000.0
Average salary in position SALESMANis: 1400.0
Average salary in position MANAGERis: 2758.3333333333335
Average salary in position PRESIDENTis: 5000.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="过滤累计函数的结果"><a href="#过滤累计函数的结果" aria-hidden="true" class="header-anchor">#</a> 过滤累计函数的结果</h4> <p>寻找平均工资高于2000的岗位</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Find avarage in position&quot;</span>
when
    <span class="token function">Emp</span><span class="token punctuation">(</span>j<span class="token operator">:</span> job<span class="token punctuation">)</span>
    <span class="token function">accumulate</span><span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>s<span class="token operator">:</span> sal<span class="token punctuation">,</span>job <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> $avgSal<span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>    
    <span class="token function">eval</span><span class="token punctuation">(</span>$avgSal <span class="token operator">&gt;</span> <span class="token number">2000</span><span class="token punctuation">)</span>   
    <span class="token comment">//   Number(doubleValue &gt; 2000) from $avgSal</span>
then
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> $avgSal<span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PRESIDENT 5000.0
MANAGER 2758.3333333333335
MANAGER 2758.3333333333335
MANAGER 2758.3333333333335
ANALYST 3000.0
ANALYST 3000.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>declare Position
   job <span class="token operator">:</span> String
   avergeSalary <span class="token operator">:</span> Double
end 

rule <span class="token string">&quot;Find avarage in position&quot;</span>
when
    <span class="token function">Emp</span><span class="token punctuation">(</span>j<span class="token operator">:</span> job<span class="token punctuation">)</span>
    <span class="token function">accumulate</span><span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>s<span class="token operator">:</span> sal<span class="token punctuation">,</span>job <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> $avgSal<span class="token operator">:</span> <span class="token function">average</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    not <span class="token function">Position</span><span class="token punctuation">(</span>job <span class="token operator">==</span> j<span class="token punctuation">)</span>    
then
 	<span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Position</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>$avgSal<span class="token punctuation">)</span><span class="token punctuation">)</span>
end

rule <span class="token string">&quot;Get position where average salary &gt; 2000&quot;</span>
when 
	$p<span class="token operator">:</span><span class="token function">Position</span><span class="token punctuation">(</span>avergeSalary <span class="token operator">&gt;</span> <span class="token number">2000</span><span class="token punctuation">)</span>
then
   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>$p<span class="token punctuation">.</span>job <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> $p<span class="token punctuation">.</span>avergeSalary<span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="选择工资高于公司平均工资的雇员"><a href="#选择工资高于公司平均工资的雇员" aria-hidden="true" class="header-anchor">#</a> 选择工资高于公司平均工资的雇员</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>when
 Number(avg : longValue) from accumulate (Emp(s: sal),average(s))
 e: Emp(sal &gt; avg)  
then    
 System.out.println(e.name + &quot; earns &quot; + e.sal + &quot; the average is &quot; + avg)  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="如果我们想寻找所有和blair有一样职位的人"><a href="#如果我们想寻找所有和blair有一样职位的人" aria-hidden="true" class="header-anchor">#</a> 如果我们想寻找所有和Blair有一样职位的人</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when
  blr<span class="token operator">:</span>  <span class="token function">Emp</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">&quot;BLAIR&quot;</span><span class="token punctuation">)</span>
  e<span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>job <span class="token operator">==</span> blr<span class="token punctuation">.</span>job<span class="token punctuation">)</span>  
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; works as &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>job<span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="我们想找20号部门里工资最高的人"><a href="#我们想找20号部门里工资最高的人" aria-hidden="true" class="header-anchor">#</a> 我们想找20号部门里工资最高的人</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>when 
  <span class="token function">Number</span><span class="token punctuation">(</span>$max <span class="token operator">:</span> intValue<span class="token punctuation">)</span> from accumulate <span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>s<span class="token operator">:</span> sal<span class="token punctuation">,</span>deptno <span class="token operator">==</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
  e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>deptno <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">,</span>sal <span class="token operator">==</span> $max<span class="token punctuation">)</span> 
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>deptno <span class="token operator">+</span><span class="token string">&quot; &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>sal <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="我们想找每个部门工资最高的人"><a href="#我们想找每个部门工资最高的人" aria-hidden="true" class="header-anchor">#</a> 我们想找每个部门工资最高的人</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when
  <span class="token function">Dept</span><span class="token punctuation">(</span>dn <span class="token operator">:</span>deptno<span class="token punctuation">)</span>
  <span class="token function">Number</span><span class="token punctuation">(</span>$max <span class="token operator">:</span> longValue<span class="token punctuation">)</span> from accumulate <span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>s<span class="token operator">:</span> sal<span class="token punctuation">,</span>deptno <span class="token operator">==</span> dn <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
  e <span class="token operator">:</span> <span class="token function">Emp</span><span class="token punctuation">(</span>deptno <span class="token operator">==</span> dn<span class="token punctuation">,</span>sal <span class="token operator">==</span> $max<span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>deptno <span class="token operator">+</span><span class="token string">&quot; &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>sal <span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="collect-functions"><a href="#collect-functions" aria-hidden="true" class="header-anchor">#</a> Collect Functions</h3> <h4 id="寻找雇员多于3人的部门"><a href="#寻找雇员多于3人的部门" aria-hidden="true" class="header-anchor">#</a> 寻找雇员多于3人的部门</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample&quot;</span>
when 
 $d <span class="token operator">:</span> <span class="token function">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 $emps <span class="token operator">:</span> ArrayList <span class="token punctuation">(</span>size <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
       from collect <span class="token punctuation">(</span><span class="token function">Emp</span><span class="token punctuation">(</span>deptno <span class="token operator">==</span> $d<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">)</span>
then    
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>$d<span class="token punctuation">.</span>dname <span class="token punctuation">)</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="自定义-accumulate-函数"><a href="#自定义-accumulate-函数" aria-hidden="true" class="header-anchor">#</a> 自定义 Accumulate 函数</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>rule <span class="token string">&quot;Sample custom sum function&quot;</span>
when
d <span class="token operator">:</span> <span class="token function">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
$total <span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span> doubleValue <span class="token operator">&gt;</span> <span class="token number">100</span> <span class="token punctuation">)</span>
  from <span class="token function">accumulate</span><span class="token punctuation">(</span> <span class="token function">Emp</span><span class="token punctuation">(</span> deptno <span class="token operator">==</span> d<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> $value <span class="token operator">:</span> sal <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">init</span><span class="token punctuation">(</span> <span class="token keyword">double</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">action</span><span class="token punctuation">(</span> total <span class="token operator">+=</span> $value<span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">reverse</span><span class="token punctuation">(</span> total <span class="token operator">-=</span> $value<span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">result</span><span class="token punctuation">(</span> total <span class="token punctuation">)</span> <span class="token punctuation">)</span>
then
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>dname <span class="token operator">+</span> <span class="token string">&quot; department has sum of salaries &quot;</span> <span class="token operator">+</span> $total<span class="token punctuation">)</span><span class="token punctuation">;</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/drools/kie-api.html" class="prev">
          KIE API简介
        </a></span> <span class="next"><a href="/drools/kie-customize.html">
          Customize KIE
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/75.4516323c.js" defer></script><script src="/assets/js/app.7863e8ac.js" defer></script>
  </body>
</html>
