(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{439:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"drools"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#drools","aria-hidden":"true"}},[s._v("#")]),s._v(" Drools")]),s._v(" "),t("h2",{attrs:{id:"drools简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#drools简介","aria-hidden":"true"}},[s._v("#")]),s._v(" Drools简介")]),s._v(" "),t("p",[s._v("Drools是Java编写的一款开源规则引擎，实现了Rete算法对所编写的规则求值，支持声明方式表达业务逻辑。使用DSL(Domain Specific Language)语言来编写业务规则，使得规则通俗易懂，便于学习理解。支持Java代码直接嵌入到规则文件中。")]),s._v(" "),t("p",[s._v("Drools主要分为两个部分：一是Drools规则，二是Drools规则的解释执行。规则的编译与运行要通过Drools 提供的相关API 来实现。而这些API 总体上游可分为三类：规则编译、规则收集和规则的执行。")]),s._v(" "),t("p",[s._v("Drools是业务规则管理系统（BRMS）解决方案，涉及以下项目：")]),s._v(" "),t("p",[s._v("Drools Workbench：业务规则管理系统\nDrools Expert：业务规则引擎\nDrools Fusion：事件处理\njBPM：工作流引擎\nOptaPlanner：规划引擎")]),s._v(" "),t("h2",{attrs:{id:"drools-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#drools-api","aria-hidden":"true"}},[s._v("#")]),s._v(" Drools API")]),s._v(" "),t("h3",{attrs:{id:"kmodule-xml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kmodule-xml","aria-hidden":"true"}},[s._v("#")]),s._v(" kmodule.xml")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token prolog"}},[s._v('<?xml version="1.0" encoding="UTF-8"?>')]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("kmodule")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("xmlns")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://www.drools.org/xsd/kmodule"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("kbase")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("name")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("rules"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("packages")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("com.rules"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ksession")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("name")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("ksession-rule"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("kbase")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("kmodule")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("package")]),s._v(" com"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rules"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{attrs:{class:"token class-name"}},[s._v("Product")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" String DIAMOND "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"DIAMOND"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{attrs:{class:"token comment"}},[s._v("// 钻石")]),s._v("\n\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" String GOLD "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"GOLD"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{attrs:{class:"token comment"}},[s._v("// 黄金")]),s._v("\n\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" String type"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" discount"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{attrs:{class:"token comment"}},[s._v("// 省略getter/setter方法")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{attrs:{class:"token keyword"}},[s._v("package")]),s._v(" com"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rules\n\n"),t("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" com"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ruls"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Product\n\nrule Offer4Diamond\n    when\n        productObject "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("Product")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" Product"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DIAMOND"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    then\n        productObject"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("setDiscount")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token number"}},[s._v("15")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    end\nrule Offer4Gold\n    when\n        productObject"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("Product")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" Product"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GOLD"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    then\n        productObject"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("setDiscount")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token number"}},[s._v("25")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    end\n\n"),t("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("testRules")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{attrs:{class:"token comment"}},[s._v("// 构建KieServices")]),s._v("\n        KieServices ks "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" KieServices"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Factory"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("get")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        KieContainer kieContainer "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ks"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("getKieClasspathContainer")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{attrs:{class:"token comment"}},[s._v("// 获取kmodule.xml中配置中名称为ksession-rule的session，默认为有状态的。")]),s._v("\n        KieSession kSession "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" kieContainer"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("newKieSession")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"ksession-rule"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        Product product "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{attrs:{class:"token class-name"}},[s._v("Product")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        product"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("setType")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Product"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GOLD"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        kSession"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("insert")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("product"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" kSession"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("fireAllRules")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        System"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("println")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"命中了"')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" count "),t("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"条规则！"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        System"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("println")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"商品"')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("product"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("getType")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"的商品折扣为"')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" product"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("getDiscount")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"%。"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])]),t("ul",[t("li",[s._v("Kmodule中可以包含一个到多个kbase，分别对应drl的规则文件。")]),s._v(" "),t("li",[s._v("Kbase需要一个唯一的name，可以取任意字符串。")]),s._v(" "),t("li",[s._v("packages为drl文件所在resource目录下的路径。注意区分drl文件中的package与此处的package不一定相同。多个包用逗号分隔。默认情况下会扫描resources目录下所有（包含子目录）规则文件。")]),s._v(" "),t("li",[s._v("kbase的default属性，标示当前KieBase是不是默认的，如果是默认的则不用名称就可以查找到该KieBase，但每个module最多只能有一个默认KieBase。")]),s._v(" "),t("li",[s._v("kbase下面可以有一个或多个ksession，ksession的name属性必须设置，且必须唯一。")])]),s._v(" "),t("h2",{attrs:{id:"标准规则文件的结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标准规则文件的结构","aria-hidden":"true"}},[s._v("#")]),s._v(" 标准规则文件的结构")]),s._v(" "),t("p",[s._v("从架构角度来讲，一般将同一业务的规则放置在同一规则文件，也可以根据不同类型处理操作放置在不同规则文件当中。不建议将所有的规则放置与一个规则文件当中。分开放置，当规则变动时不至于影响到不相干的业务。读取构建规则的成本业务会相应减少。")]),s._v(" "),t("p",[s._v("标准规则文件的结构如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("package package-name\n\nimports\n\nglobals\n\nfunctions\n\nqueries\n\nrules\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("strong",[s._v("package")]),s._v("：在一个规则文件当中package是必须的，而且必须放置在文件的第一行。package 的名字是随意的，不必必须对应物理路径，这里跟java的package的概念不同，只是逻辑上的区分，但建议与文件路径一致。同一的package下定义的function和query等可以直接使用。\n比如，上面实例中package的定义：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[s._v("package")]),s._v(" com"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rules\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("import")]),s._v("：导入规则文件需要的外部变量，使用方法跟java相同。像java的是import一样，还可以导入类中的某一个可访问的静态方法。（特别注意的是，某些教程中提示import引入静态方法是不同于java的一方面，可能是作者没有用过java的静态方法引入。）另外，目前针对Drools7版本，static和function关键字的效果是一样的。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" com"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("secbro"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("drools"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DroolsStringUtils"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("isEmpty"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" function com"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("secbro"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("drools"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DroolsStringUtils"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("isEmpty"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("rules")]),s._v("：定义一个条规则。rule “ruleName”。一条规则包含三部分：属性部分、条件部分和结果部分。rule规则以rule开头，以end结尾。")]),s._v(" "),t("p",[s._v("属性部分：定义当前规则执行的一些属性等，比如是否可被重复执行、过期时间、生效时间等。")]),s._v(" "),t("p",[s._v("条件部分，简称LHS，即Left Hand Side。定义当前规则的条件，处于when和then之间。如when Message();判断当前workingMemory中是否存在Message对象。LHS中，可包含0~n个条件，如果没有条件，默认为eval(true)，也就是始终返回 true。")]),s._v(" "),t("p",[s._v("结果部分，简称RHS，即Right Hand Side，处于then和end之间，用于处理满足条件之后的业务逻辑。可以使用LHS部分定义的变量名、设置的全局变量、或者是直接编写Java 代码。")]),s._v(" "),t("p",[s._v("RHS部分可以直接编写Java代码，但不建议在代码当中有条件判断，如果需要条件判断，那么需要重新考虑将其放在LHS部分，否则就违背了使用规则的初衷。")]),s._v(" "),t("p",[s._v("RHS部分，提供了一些对当前Working Memory实现快速操作的宏函数或对象，比如 insert/insertLogical、update/modify和retract等。利用这些函数可以实现对当前Working Memory中的Fact对象进行新增、修改或删除操作；如果还要使用Drools提供的其它方法，可以使用另一个外宏对象drools，通过该对象可以使用更多的方法；同时Drools 还提供了一个名为kcontext的宏对象，可以通过该对象直接访问当前Working Memory的 KnowledgeRuntime。")]),s._v(" "),t("p",[s._v("标准规则的结构示例：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('rule "name"\n    attributes\n    when\n        LHS\n    then \n        RHS\n    end\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("LHS为空示例:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('rule "name"\nwhen \nthen \nend\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"规则的attributes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#规则的attributes","aria-hidden":"true"}},[s._v("#")]),s._v(" 规则的attributes")]),s._v(" "),t("h3",{attrs:{id:"no-loop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#no-loop","aria-hidden":"true"}},[s._v("#")]),s._v(" no-loop")]),s._v(" "),t("p",[s._v("定义当前的规则是否不允许多次循环执行，默认是 false，也就是当前的规则只要满足条件，可以无限次执行。")]),s._v(" "),t("h3",{attrs:{id:"lock-on-active"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lock-on-active","aria-hidden":"true"}},[s._v("#")]),s._v(" lock-on-active")]),s._v(" "),t("p",[s._v("当在规则上使用ruleflow-group属性或agenda-group属性的时候，将lock-on-active 属性的值设置为true，可避免因某些Fact对象被修改而使已经执行过的规则再次被激活执行。可以看出该属性与no-loop属性有相似之处，no-loop属性是为了避免Fact被修改或调用了insert、retract、update之类的方法而导致规则再次激活执行，这里的lock-on-active 属性起同样的作用，lock-on-active是no-loop的增强版属性，它主要作用在使用ruleflow-group属性或agenda-group属性的时候。lock-on-active属性默认值为false。与no-loop不同的是lock-on-active可以避免其他规则修改FACT对象导致规则的重新执行。")]),s._v(" "),t("h3",{attrs:{id:"ruleflow-group"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ruleflow-group","aria-hidden":"true"}},[s._v("#")]),s._v(" ruleflow-group")]),s._v(" "),t("p",[s._v("在使用规则流的时候要用到ruleflow-group属性，该属性的值为一个字符串，作用是将规则划分为一个个的组，然后在规则流当中通过使用ruleflow-group属性的值，从而使用对应的规则。该属性会通过流程的走向确定要执行哪一条规则。在规则流中有具体的说明。")]),s._v(" "),t("h3",{attrs:{id:"salience"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#salience","aria-hidden":"true"}},[s._v("#")]),s._v(" salience")]),s._v(" "),t("p",[s._v("用来设置规则执行的优先级，salience属性的值是一个数字，数字越大执行优先级越高，同时它的值可以是一个负数。默认情况下，规则的salience默认值为0。如果不设置规则的salience属性，那么执行顺序是随机的。")]),s._v(" "),t("h3",{attrs:{id:"agenda-group"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#agenda-group","aria-hidden":"true"}},[s._v("#")]),s._v(" agenda-group")]),s._v(" "),t("p",[s._v("规则的调用与执行是通过StatelessKieSession或KieSession来实现的，一般的顺序是创建一个StatelessKieSession或KieSession，将各种经过编译的规则添加到session当中，然后将规则当中可能用到的Global对象和Fact对象插入到Session当中，最后调用fireAllRules 方法来触发、执行规则。")]),s._v(" "),t("p",[s._v("在没有调用fireAllRules方法之前，所有的规则及插入的Fact对象都存放在一个Agenda表的对象当中，这个Agenda表中每一个规则及与其匹配相关业务数据叫做Activation，在调用fireAllRules方法后，这些Activation会依次执行，执行顺序在没有设置相关控制顺序属性时（比如salience属性），它的执行顺序是随机的。")]),s._v(" "),t("p",[s._v("Agenda Group是用来在Agenda基础上对规则进行再次分组，可通过为规则添加agenda-group属性来实现。agenda-group属性的值是一个字符串，通过这个字符串，可以将规则分为若干个Agenda Group。引擎在调用设置了agenda-group属性的规则时需要显示的指定某个Agenda Group得到Focus（焦点），否则将不执行该Agenda Group当中的规则。")]),s._v(" "),t("h3",{attrs:{id:"auto-focus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#auto-focus","aria-hidden":"true"}},[s._v("#")]),s._v(" auto-focus")]),s._v(" "),t("h3",{attrs:{id:"activation-group"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#activation-group","aria-hidden":"true"}},[s._v("#")]),s._v(" activation-group")]),s._v(" "),t("h3",{attrs:{id:"dialect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dialect","aria-hidden":"true"}},[s._v("#")]),s._v(" dialect")]),s._v(" "),t("p",[s._v("该属性用来定义规则（LHS、RHS）当中要使用的语言类型，可选值为“java”或“mvel”。默认情况下使用java语言。当在包级别指定方言时，这个属性可以在具体的规则中覆盖掉包级别的指定。")]),s._v(" "),t("h3",{attrs:{id:"date-effective"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#date-effective","aria-hidden":"true"}},[s._v("#")]),s._v(" date-effective")]),s._v(" "),t("p",[s._v("该属性是用来控制规则只有在到达指定时间后才会触发。在规则运行时，引擎会拿当前操作系统的时间与date-effective设置的时间值进行比对，只有当系统时间大于等于date-effective设置的时间值时，规则才会触发执行，否则执行将不执行。在没有设置该属性的情况下，规则随时可以触发")]),s._v(" "),t("h3",{attrs:{id:"date-expires"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#date-expires","aria-hidden":"true"}},[s._v("#")]),s._v(" date-expires")]),s._v(" "),t("p",[s._v("此属性与date-effective的作用相反，用来设置规则的过期时间。时间格式可完全参考date-effective的时间格式。引擎在执行规则时会检查属性是否设置，如果设置则比较当前系统时间与设置时间，如果设置时间大于系统时间，则执行规则，否则不执行。")]),s._v(" "),t("h3",{attrs:{id:"enabled"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enabled","aria-hidden":"true"}},[s._v("#")]),s._v(" enabled")]),s._v(" "),t("p",[s._v("设置规则是否可用。true：表示该规则可用；false：表示该规则不可用。")])])}],!1,null,null,null);e.options.__file="drools.md";a.default=e.exports}}]);