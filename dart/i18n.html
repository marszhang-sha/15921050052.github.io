<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Internationalization - Make an Flutter application multi-lingual | 油腻中年大叔</title>
    <meta name="description" content="你想要的这里都没有，你不想要的这里都有">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/assets/css/styles.7863e8ac.css" as="style"><link rel="preload" href="/assets/js/app.7863e8ac.js" as="script"><link rel="preload" href="/assets/js/96.e3124488.js" as="script"><link rel="prefetch" href="/assets/js/0.eb7108e7.js"><link rel="prefetch" href="/assets/js/1.d8ec4d72.js"><link rel="prefetch" href="/assets/js/2.28f90b8d.js"><link rel="prefetch" href="/assets/js/3.6001361f.js"><link rel="prefetch" href="/assets/js/4.80c27a58.js"><link rel="prefetch" href="/assets/js/5.2e2f809b.js"><link rel="prefetch" href="/assets/js/6.0d0d8441.js"><link rel="prefetch" href="/assets/js/7.8e4037c3.js"><link rel="prefetch" href="/assets/js/8.5752a787.js"><link rel="prefetch" href="/assets/js/9.8329deb8.js"><link rel="prefetch" href="/assets/js/10.4843c5ba.js"><link rel="prefetch" href="/assets/js/11.9e8b7549.js"><link rel="prefetch" href="/assets/js/12.02c0fa30.js"><link rel="prefetch" href="/assets/js/13.f5d738e8.js"><link rel="prefetch" href="/assets/js/14.ca4b3249.js"><link rel="prefetch" href="/assets/js/15.cf61b2ec.js"><link rel="prefetch" href="/assets/js/16.2b67aa0e.js"><link rel="prefetch" href="/assets/js/17.b99a459f.js"><link rel="prefetch" href="/assets/js/18.2d5afa9a.js"><link rel="prefetch" href="/assets/js/19.6c36dff4.js"><link rel="prefetch" href="/assets/js/20.3e0dc870.js"><link rel="prefetch" href="/assets/js/21.227ee5ec.js"><link rel="prefetch" href="/assets/js/22.05c1f0f0.js"><link rel="prefetch" href="/assets/js/23.c6dbeed0.js"><link rel="prefetch" href="/assets/js/24.957b4252.js"><link rel="prefetch" href="/assets/js/25.b50e4879.js"><link rel="prefetch" href="/assets/js/26.1b2b16cf.js"><link rel="prefetch" href="/assets/js/27.2f0f5e4c.js"><link rel="prefetch" href="/assets/js/28.ffafaa79.js"><link rel="prefetch" href="/assets/js/29.38ab4732.js"><link rel="prefetch" href="/assets/js/30.7258c2eb.js"><link rel="prefetch" href="/assets/js/31.6cc6f25e.js"><link rel="prefetch" href="/assets/js/32.cae8f5c2.js"><link rel="prefetch" href="/assets/js/33.7bac5900.js"><link rel="prefetch" href="/assets/js/34.e457a7ab.js"><link rel="prefetch" href="/assets/js/35.6a4f99be.js"><link rel="prefetch" href="/assets/js/36.3fa7b425.js"><link rel="prefetch" href="/assets/js/37.9627a576.js"><link rel="prefetch" href="/assets/js/38.8f902270.js"><link rel="prefetch" href="/assets/js/39.2fb6b1fd.js"><link rel="prefetch" href="/assets/js/40.0f992849.js"><link rel="prefetch" href="/assets/js/41.1921a30c.js"><link rel="prefetch" href="/assets/js/42.196053b0.js"><link rel="prefetch" href="/assets/js/43.6a2cc6b2.js"><link rel="prefetch" href="/assets/js/44.c3b31b69.js"><link rel="prefetch" href="/assets/js/45.dd90e897.js"><link rel="prefetch" href="/assets/js/46.547a7ce9.js"><link rel="prefetch" href="/assets/js/47.a62be284.js"><link rel="prefetch" href="/assets/js/48.edc6618c.js"><link rel="prefetch" href="/assets/js/49.b3d5118e.js"><link rel="prefetch" href="/assets/js/50.81540475.js"><link rel="prefetch" href="/assets/js/51.c2c1171b.js"><link rel="prefetch" href="/assets/js/52.ba318094.js"><link rel="prefetch" href="/assets/js/53.a2d5d15e.js"><link rel="prefetch" href="/assets/js/54.3608cfdf.js"><link rel="prefetch" href="/assets/js/55.73c0d459.js"><link rel="prefetch" href="/assets/js/56.9706fe8c.js"><link rel="prefetch" href="/assets/js/57.f5a08e9a.js"><link rel="prefetch" href="/assets/js/58.ea9c9ad0.js"><link rel="prefetch" href="/assets/js/59.9d363669.js"><link rel="prefetch" href="/assets/js/60.8a80b28f.js"><link rel="prefetch" href="/assets/js/61.73e5c6a8.js"><link rel="prefetch" href="/assets/js/62.30aab875.js"><link rel="prefetch" href="/assets/js/63.1e86c5c0.js"><link rel="prefetch" href="/assets/js/64.9c071a1e.js"><link rel="prefetch" href="/assets/js/65.61d8d11c.js"><link rel="prefetch" href="/assets/js/66.dd39544e.js"><link rel="prefetch" href="/assets/js/67.6dd79cd2.js"><link rel="prefetch" href="/assets/js/68.dd07b2a3.js"><link rel="prefetch" href="/assets/js/69.a5a81dbc.js"><link rel="prefetch" href="/assets/js/70.3f26faed.js"><link rel="prefetch" href="/assets/js/71.1234830b.js"><link rel="prefetch" href="/assets/js/72.d4db7f16.js"><link rel="prefetch" href="/assets/js/73.e2b0a283.js"><link rel="prefetch" href="/assets/js/74.db6d3ebc.js"><link rel="prefetch" href="/assets/js/75.4516323c.js"><link rel="prefetch" href="/assets/js/76.a086fd94.js"><link rel="prefetch" href="/assets/js/77.165f6d28.js"><link rel="prefetch" href="/assets/js/78.81cd058e.js"><link rel="prefetch" href="/assets/js/79.fde8c00b.js"><link rel="prefetch" href="/assets/js/80.142b728c.js"><link rel="prefetch" href="/assets/js/81.367c9c5e.js"><link rel="prefetch" href="/assets/js/82.d23176e0.js"><link rel="prefetch" href="/assets/js/83.d9571f6f.js"><link rel="prefetch" href="/assets/js/84.6214056c.js"><link rel="prefetch" href="/assets/js/85.66cc6092.js"><link rel="prefetch" href="/assets/js/86.18dba812.js"><link rel="prefetch" href="/assets/js/87.9506d9f8.js"><link rel="prefetch" href="/assets/js/88.b42d6720.js"><link rel="prefetch" href="/assets/js/89.5c0033c4.js"><link rel="prefetch" href="/assets/js/90.069a50d4.js"><link rel="prefetch" href="/assets/js/91.61fe3c31.js"><link rel="prefetch" href="/assets/js/92.e4211585.js"><link rel="prefetch" href="/assets/js/93.6df74471.js"><link rel="prefetch" href="/assets/js/94.d61ebe6e.js"><link rel="prefetch" href="/assets/js/95.c60c8a69.js"><link rel="prefetch" href="/assets/js/97.bce37e32.js"><link rel="prefetch" href="/assets/js/98.a1fb95ac.js"><link rel="prefetch" href="/assets/js/99.f9c12b84.js"><link rel="prefetch" href="/assets/js/100.0b3aaca9.js"><link rel="prefetch" href="/assets/js/101.03f32ae7.js"><link rel="prefetch" href="/assets/js/102.69cca032.js"><link rel="prefetch" href="/assets/js/103.190dc3ef.js"><link rel="prefetch" href="/assets/js/104.6e7ceda7.js"><link rel="prefetch" href="/assets/js/105.f852f5a7.js"><link rel="prefetch" href="/assets/js/106.9335f238.js"><link rel="prefetch" href="/assets/js/107.1404f516.js"><link rel="prefetch" href="/assets/js/108.dd6bb5e3.js"><link rel="prefetch" href="/assets/js/109.a87f5640.js"><link rel="prefetch" href="/assets/js/110.fb0da049.js"><link rel="prefetch" href="/assets/js/111.cc64ddd7.js"><link rel="prefetch" href="/assets/css/112.styles.75c39ee5.css"><link rel="prefetch" href="/assets/js/112.75c39ee5.js"><link rel="prefetch" href="/assets/css/113.styles.407e8d7f.css"><link rel="prefetch" href="/assets/js/113.407e8d7f.js">
    <link rel="stylesheet" href="/assets/css/112.styles.75c39ee5.css"><link rel="stylesheet" href="/assets/css/113.styles.407e8d7f.css"><link rel="stylesheet" href="/assets/css/styles.7863e8ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">油腻中年大叔</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dart/" class="nav-link router-link-active">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/rubik/" class="nav-link">魔方</a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dart/" class="nav-link router-link-active">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/rubik/" class="nav-link">魔方</a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/dart/platform.html" class="sidebar-link">支持的平台</a></li><li><a href="/dart/basics.html" class="sidebar-link">基本语法</a></li><li><a href="/dart/libs.html" class="sidebar-link">基本库</a></li><li><a href="/dart/async.html" class="sidebar-link">异步</a></li><li><a href="/dart/routes.html" class="sidebar-link">Flutter 路由</a></li><li><a href="/dart/layout.html" class="sidebar-link">Flutter 布局</a></li><li><a href="/dart/animation.html" class="sidebar-link">Flutter 动画</a></li><li><a href="/dart/state.html" class="sidebar-link">Stateless和StatefulWidget</a></li><li><a href="/dart/widgetcheetsheet.html" class="sidebar-link">Flutter Widget Cheet Sheet</a></li><li><a href="/dart/cheetsheet.html" class="sidebar-link">Another Flutter Cheet Sheet</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="internationalization-make-an-flutter-application-multi-lingual"><a href="#internationalization-make-an-flutter-application-multi-lingual" aria-hidden="true" class="header-anchor">#</a> Internationalization - Make an Flutter application multi-lingual</h1> <p>forward from: https://www.didierboelens.com/2018/04/internationalization---make-an-flutter-application-multi-lingual/</p> <p>This article explains a way to make your Flutter application multilingual and to allow the user to select another working language, other than the one, defined at the Smartphone’s settings.</p> <h2 id="forewords"><a href="#forewords" aria-hidden="true" class="header-anchor">#</a> Forewords</h2> <p>Internationalization has already been explained several times and the Flutter official documentation on this topic may be found here.</p> <p>As I wanted to understand it correctly but also, because I needed to extend it to meet my application’s requirements, I decided to write the following article to share my experience and give you some hints.</p> <h2 id="requirements"><a href="#requirements" aria-hidden="true" class="header-anchor">#</a> Requirements</h2> <ul><li>By default, the working language should be the one configured in the Smartphone (system settings)</li> <li>If the default language is not supported by the application, ‘en’ becomes the default</li> <li>Translations are stored in language specific JSON files, as assets</li> <li>The user may select another working language, from a list of supported languages</li> <li>When the user selects another language, the whole application layout is refreshed in order to be displayed in the newly selected language</li></ul> <h2 id="external-dependencies"><a href="#external-dependencies" aria-hidden="true" class="header-anchor">#</a> External dependencies</h2> <p>Flutter natively supports localization (notion of Locale). The Locale class is used to identity the user’s language. One of the properties of this class defines the languageCode.</p> <p>To use the localization package, you will need to use the flutter_localizations package. To do so, you will have to add it as a dependency to your pubspec.yaml file as follows:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">flutter</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
  <span class="token key atrule">flutter_localizations</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>When saving the pubspec.yaml, you will be prompted to load/import the dependencies: accept and load/import them.</p> <h2 id="translation-files"><a href="#translation-files" aria-hidden="true" class="header-anchor">#</a> Translation files</h2> <p>The next step is to create the translations files and define them as assets.</p> <p>From my past experience developing websites, I used to store these assets in a folder called “/locale”, under the naming convention: i18n_{lang}.json. I will use the same principle in this article.</p> <p>Therefore, create a new folder at the same level as the /lib and call it “/locale”. In this folder, create 2 files, respectively named: i18n_en.json and i18n_fr.json.</p> <p>The folders tree should then look like the following:</p> <p>MyApplication
|
+- android
+- build
+- images
+- ios
+- lib
+- locale
|
+- i18n_en.json
+- i18n_fr.json
+- test</p> <p>Now, we need to make these 2 files, part of the assets.</p> <p>In order to do this, you will have to edit the pubspec.yaml file and add then both to the assets: section, as follows:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">flutter</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
  <span class="token key atrule">flutter_localizations</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter

<span class="token key atrule">flutter</span><span class="token punctuation">:</span>
  <span class="token key atrule">assets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> locale/i18n_en.json
    <span class="token punctuation">-</span> locale/i18n_fr.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="implementation"><a href="#implementation" aria-hidden="true" class="header-anchor">#</a> Implementation</h2> <p>It is now time to start with the implementation…</p> <p>Let’s start at the beginning, the application’s main initialization: main.dart</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter_localizations/flutter_localizations.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'translations.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token comment">// This widget is the root of your application.</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
      title<span class="token punctuation">:</span> <span class="token string">'My Application'</span><span class="token punctuation">,</span>
      theme<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ThemeData</span><span class="token punctuation">(</span>
        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      localizationsDelegates<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">const</span> <span class="token function">TranslationsDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        GlobalMaterialLocalizations<span class="token punctuation">.</span>delegate<span class="token punctuation">,</span>
        GlobalWidgetsLocalizations<span class="token punctuation">.</span>delegate<span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      supportedLocales<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">const</span> <span class="token function">Locale</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">const</span> <span class="token function">Locale</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      home<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
          appBar<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>
            title<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">'My Title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          body<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>        
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li>Line #2: simply imports the flutter localizations package</li> <li>Line #3: imports the personal library that handles the translations (see later)</li> <li>Lines #16-20: are factories that produce collections of localized values.
<ul><li>GlobalMaterialLocalizations.delegate provides localized strings and other values for the Material Components library.</li> <li>GlobalWidgetsLocalizations.delegate defines the default text direction, either left to right or right to left, for the widgets library</li> <li>const TranslationsDelegate() points to the personal library to handle the translations (see later)</li></ul></li> <li>Lines #21-24: list of the supported languages</li></ul> <p>Let’s now have a look at the personal library that handles the translations: translations.dart.</p> <p>Under /lib, create a new file, named “translations.dart”.</p> <p>The initial content of the translations.dart file is:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import 'dart:async';
import 'dart:convert';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart' show  rootBundle;

class Translations {
  Translations(Locale locale) {
    this.locale = locale;
    _localizedValues = null;
  }

  Locale locale;
  static Map&lt;dynamic, dynamic&gt; _localizedValues;

  static Translations of(BuildContext context){
    return Localizations.of&lt;Translations&gt;(context, Translations);
  }

  String text(String key) {
    return _localizedValues[key] ?? '** $key not found';
  }

  static Future&lt;Translations&gt; load(Locale locale) async {
    Translations translations = new Translations(locale);
    String jsonContent = await rootBundle.loadString(&quot;locale/i18n_${locale.languageCode}.json&quot;);
    _localizedValues = json.decode(jsonContent);
    return translations;
  }

  get currentLanguage =&gt; locale.languageCode;
}

class TranslationsDelegate extends LocalizationsDelegate&lt;Translations&gt; {
  const TranslationsDelegate();

  @override
  bool isSupported(Locale locale) =&gt; ['en','fr'].contains(locale.languageCode);

  @override
  Future&lt;Translations&gt; load(Locale locale) =&gt; Translations.load(locale);

  @override
  bool shouldReload(TranslationsDelegate old) =&gt; false;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><ul><li>Lines #33-44: definition of the personal localization delegate. Its role is to instantiate our personal Translations class (line 40), proceeding with validation of supported languages (line 37).</li> <li>Lines #6-31: definition of the personal Translations class.</li></ul> <h2 id="explanation-of-the-translations-class"><a href="#explanation-of-the-translations-class" aria-hidden="true" class="header-anchor">#</a> Explanation of the Translations class</h2> <p>The main objectives of this class are:</p> <ul><li>when instantiated by the TranslationsDelegate class, the class receives the Locale to be used for the translations. At first instantiation, the Locale which is passed as argument to the constructor of the class corresponds to the Smartphone Locale as defined in the Settings.</li> <li>the constructor simply memorizes this Locale and resets the Map that is going to hold the translations in that Locale.languageCode</li> <li>the load method when called by the TranslationsDelegate class, initializes a new instance of the Translations class, loads the content of the i18n_{language}.json file and converts the JSON to a Map. It then returns the new instance of the class.</li> <li>method Translations of(BuildContext context) is used to return a pointer to this instance of the class. This is will used when we will need to get the translations of a certain string/label (see later)</li> <li>text(String key) will be used to return the translation of a certain string/label, based on the content of the Map (see later).</li> <li>currentLanguage is a getter to return the language, currently being used.</li></ul> <h2 id="how-to-structure-the-i18n-language-json-files"><a href="#how-to-structure-the-i18n-language-json-files" aria-hidden="true" class="header-anchor">#</a> How to structure the i18n_{language}.json files?</h2> <p>These files are JSON files, which have to stick to the JSON syntax rules.</p> <p>These files will contain a series of key/value pairs, as in the following example (i18n_en.json):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;app_title&quot;: &quot;My Application Title&quot;,
    &quot;main_title&quot;: &quot;My Main Title&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Warning!: unlike Dart/Flutter good practice, JSON syntax does not accept trailing comma’s!</p> <p>It is now up to you to fill both i18n_en.json and i18n_fr.json files with the key/value pairs.</p> <p>For this example, the counter part in French would be (i18n_fr.json):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;app_title&quot;: &quot;Le titre de mon application&quot;,
    &quot;main_title&quot;: &quot;Mon titre principal&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="how-to-get-the-translations"><a href="#how-to-get-the-translations" aria-hidden="true" class="header-anchor">#</a> How to get the translations?</h2> <p>To get the translation of a certain label/string, pass the context and the label you want to be translated as follows:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@override
  Widget build(BuildContext context) {
    return new Scaffold(
      appBar: new AppBar(
        title: new Text(Translations.of(context).text('main_title')),
    ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="how-to-dynamically-change-the-working-language"><a href="#how-to-dynamically-change-the-working-language" aria-hidden="true" class="header-anchor">#</a> How to dynamically change the working language?</h2> <p>OK, now that we know how to define the languages, the translations and use the translations, how can we let the user change the working language?</p> <p>In order to do this, we need to way to force the refresh of the whole application layout when the user selects another working language. Therefore, we need to application to handle a setState().</p> <p>Before going any further, let’s refactor the code and let’s create a new file, called application.dart.</p> <p>This file will be used for 2 purposes:</p> <ul><li>repository of application settings</li> <li>share globals</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>typedef void LocaleChangeCallback(Locale locale);
class APPLIC {
    // List of supported languages
    final List&lt;String&gt; supportedLanguages = ['en','fr'];

    // Returns the list of supported Locales
    Iterable&lt;Locale&gt; supportedLocales() =&gt; supportedLanguages.map&lt;Locale&gt;((lang) =&gt; new Locale(lang, ''));

    // Function to be invoked when changing the working language
    LocaleChangeCallback onLocaleChanged;

    ///
    /// Internals
    ///
    static final APPLIC _applic = new APPLIC._internal();

    factory APPLIC(){
        return _applic;
    }

    APPLIC._internal();
}

APPLIC applic = new APPLIC();

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>This is a self-initializing class. Each time it will be imported in the source code, the very same instance of the class will be returned.</p> <p>Let’s now make the application “refreshable”…</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import 'package:flutter/material.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'translations.dart';
import 'application.dart';

void main() =&gt; runApp(new MyApp());

class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() =&gt; new _MyAppState();
}

class _MyAppState extends State&lt;MyApp&gt; {
  SpecificLocalizationDelegate _localeOverrideDelegate;

  @override
  void initState(){
    super.initState();
    _localeOverrideDelegate = new SpecificLocalizationDelegate(null);
    ///
    /// Let's save a pointer to this method, should the user wants to change its language
    /// We would then call: applic.onLocaleChanged(new Locale('en',''));
    /// 
    applic.onLocaleChanged = onLocaleChange;
  }

  onLocaleChange(Locale locale){
    setState((){
      _localeOverrideDelegate = new SpecificLocalizationDelegate(locale);
    });
  }

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return new MaterialApp(
      title: 'My Application',
      theme: new ThemeData(
        primarySwatch: Colors.blue,
      ),
      localizationsDelegates: [
        _localeOverrideDelegate,
        const TranslationsDelegate(),
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
      ],
      supportedLocales: applic.supportedLocales(),
      home: new MyHomePage(),
    );
  }
}

class MyHomePage extends StatefulWidget {
  _MyHomePageState createState() =&gt; new _MyHomePageState();
}

class _MyHomePageState extends State&lt;MyHomePage&gt;{
  @override
  Widget build(BuildContext context){
    return new Scaffold(
      appBar: new AppBar(
        title: new Text(Translations.of(context).text('main_title')),
      ),
      body: new Container(),
    );
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><ul><li>Lines #8-13: The first modification to apply is to make the application Stateful. This will allow us to respond to a request for refresh and invoke the application SetState().</li> <li>Line #19: we need to instantiate a new Localization Delegate, which will be used to force a new instantiation of the Translations class when the user will select another working language.</li> <li>Line #24: we save in the Global APPLIC class a pointer to a method which will be used to force a full application refresh, via the SetState()</li> <li>Lines #27-31: the heart of the application refresh when we change the language. Each time another language is selected, a new instance of the SpecificLocalizationDelegate is created, which, we will see just after, will force a refresh of the Translations class.</li> <li>Line #42: we register the new delegate</li> <li>Line #47: refactoring. Now that we have a Global APPLIC class to hold the settings, let’s use it.</li> <li>Line #62: let’s take the opportunity to use the translations library.</li></ul> <p>Now we need to apply some changes to the Translations.dart file… (final version)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import 'dart:async';
import 'dart:convert';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart' show  rootBundle;
import 'application.dart';

class Translations {
  Translations(Locale locale) {
    this.locale = locale;
    _localizedValues = null;
  }

  Locale locale;
  static Map&lt;dynamic, dynamic&gt; _localizedValues;

  static Translations of(BuildContext context){
    return Localizations.of&lt;Translations&gt;(context, Translations);
  }

  String text(String key) {
    return _localizedValues[key] ?? '** $key not found';
  }

  static Future&lt;Translations&gt; load(Locale locale) async {
    Translations translations = new Translations(locale);
    String jsonContent = await rootBundle.loadString(&quot;locale/i18n_${locale.languageCode}.json&quot;);
    _localizedValues = json.decode(jsonContent);
    return translations;
  }

  get currentLanguage =&gt; locale.languageCode;
}

class TranslationsDelegate extends LocalizationsDelegate&lt;Translations&gt; {
  const TranslationsDelegate();

  @override
  bool isSupported(Locale locale) =&gt; applic.supportedLanguages.contains(locale.languageCode);

  @override
  Future&lt;Translations&gt; load(Locale locale) =&gt; Translations.load(locale);

  @override
  bool shouldReload(TranslationsDelegate old) =&gt; false;
}

class SpecificLocalizationDelegate extends LocalizationsDelegate&lt;Translations&gt; {
  final Locale overriddenLocale;

  const SpecificLocalizationDelegate(this.overriddenLocale);

  @override
  bool isSupported(Locale locale) =&gt; overriddenLocale != null;

  @override
  Future&lt;Translations&gt; load(Locale locale) =&gt; Translations.load(overriddenLocale);

  @override
  bool shouldReload(LocalizationsDelegate&lt;Translations&gt; old) =&gt; true;
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><ul><li>Line #38: refactoring in order not to hardcode the supported languages</li> <li>Lines #47-60: the implementation of the Delegate, which forces a new instantiation of the Translations class each time a new language is selected.</li></ul> <p>How to apply a change of working language?
Here is the cherry on the cake!</p> <p>To force another working language, one single line of code is necessary, anywhere in the source code of the application:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>applic.onLocaleChanged(new Locale('fr',''));

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Thanks to the Global applic instance, we can make a call to the Main application method onLocaleChange(Locale locale), which will create a new instance of the Delegate, which in turn will force a new instance of the Translations class, with the new language.</p> <p>The whole application will then be refreshed.</p> <h2 id="conclusions"><a href="#conclusions" aria-hidden="true" class="header-anchor">#</a> Conclusions</h2> <p>I am sure other solutions exist, maybe with better code.</p> <p>The sole objective of this article is to share a solution that works for me, which I hope could also help others.</p> <p>In a next article, I will detail a dedicated Widget to select working languages, which will complement this article.</p> <p>Stay tuned and happy coding.</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/96.e3124488.js" defer></script><script src="/assets/js/app.7863e8ac.js" defer></script>
  </body>
</html>
