<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>自定义Camel组件 | 油腻中年大叔</title>
    <meta name="description" content="你想要的这里都没有，你不想要的这里都有">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/assets/css/styles.7863e8ac.css" as="style"><link rel="preload" href="/assets/js/app.7863e8ac.js" as="script"><link rel="preload" href="/assets/js/71.1234830b.js" as="script"><link rel="prefetch" href="/assets/js/0.eb7108e7.js"><link rel="prefetch" href="/assets/js/1.d8ec4d72.js"><link rel="prefetch" href="/assets/js/2.28f90b8d.js"><link rel="prefetch" href="/assets/js/3.6001361f.js"><link rel="prefetch" href="/assets/js/4.80c27a58.js"><link rel="prefetch" href="/assets/js/5.2e2f809b.js"><link rel="prefetch" href="/assets/js/6.0d0d8441.js"><link rel="prefetch" href="/assets/js/7.8e4037c3.js"><link rel="prefetch" href="/assets/js/8.5752a787.js"><link rel="prefetch" href="/assets/js/9.8329deb8.js"><link rel="prefetch" href="/assets/js/10.4843c5ba.js"><link rel="prefetch" href="/assets/js/11.9e8b7549.js"><link rel="prefetch" href="/assets/js/12.02c0fa30.js"><link rel="prefetch" href="/assets/js/13.f5d738e8.js"><link rel="prefetch" href="/assets/js/14.ca4b3249.js"><link rel="prefetch" href="/assets/js/15.cf61b2ec.js"><link rel="prefetch" href="/assets/js/16.2b67aa0e.js"><link rel="prefetch" href="/assets/js/17.b99a459f.js"><link rel="prefetch" href="/assets/js/18.2d5afa9a.js"><link rel="prefetch" href="/assets/js/19.6c36dff4.js"><link rel="prefetch" href="/assets/js/20.3e0dc870.js"><link rel="prefetch" href="/assets/js/21.227ee5ec.js"><link rel="prefetch" href="/assets/js/22.05c1f0f0.js"><link rel="prefetch" href="/assets/js/23.c6dbeed0.js"><link rel="prefetch" href="/assets/js/24.957b4252.js"><link rel="prefetch" href="/assets/js/25.b50e4879.js"><link rel="prefetch" href="/assets/js/26.1b2b16cf.js"><link rel="prefetch" href="/assets/js/27.2f0f5e4c.js"><link rel="prefetch" href="/assets/js/28.ffafaa79.js"><link rel="prefetch" href="/assets/js/29.38ab4732.js"><link rel="prefetch" href="/assets/js/30.7258c2eb.js"><link rel="prefetch" href="/assets/js/31.6cc6f25e.js"><link rel="prefetch" href="/assets/js/32.cae8f5c2.js"><link rel="prefetch" href="/assets/js/33.7bac5900.js"><link rel="prefetch" href="/assets/js/34.e457a7ab.js"><link rel="prefetch" href="/assets/js/35.6a4f99be.js"><link rel="prefetch" href="/assets/js/36.3fa7b425.js"><link rel="prefetch" href="/assets/js/37.9627a576.js"><link rel="prefetch" href="/assets/js/38.8f902270.js"><link rel="prefetch" href="/assets/js/39.2fb6b1fd.js"><link rel="prefetch" href="/assets/js/40.0f992849.js"><link rel="prefetch" href="/assets/js/41.1921a30c.js"><link rel="prefetch" href="/assets/js/42.196053b0.js"><link rel="prefetch" href="/assets/js/43.6a2cc6b2.js"><link rel="prefetch" href="/assets/js/44.c3b31b69.js"><link rel="prefetch" href="/assets/js/45.dd90e897.js"><link rel="prefetch" href="/assets/js/46.547a7ce9.js"><link rel="prefetch" href="/assets/js/47.a62be284.js"><link rel="prefetch" href="/assets/js/48.edc6618c.js"><link rel="prefetch" href="/assets/js/49.b3d5118e.js"><link rel="prefetch" href="/assets/js/50.81540475.js"><link rel="prefetch" href="/assets/js/51.c2c1171b.js"><link rel="prefetch" href="/assets/js/52.ba318094.js"><link rel="prefetch" href="/assets/js/53.a2d5d15e.js"><link rel="prefetch" href="/assets/js/54.3608cfdf.js"><link rel="prefetch" href="/assets/js/55.73c0d459.js"><link rel="prefetch" href="/assets/js/56.9706fe8c.js"><link rel="prefetch" href="/assets/js/57.f5a08e9a.js"><link rel="prefetch" href="/assets/js/58.ea9c9ad0.js"><link rel="prefetch" href="/assets/js/59.9d363669.js"><link rel="prefetch" href="/assets/js/60.8a80b28f.js"><link rel="prefetch" href="/assets/js/61.73e5c6a8.js"><link rel="prefetch" href="/assets/js/62.30aab875.js"><link rel="prefetch" href="/assets/js/63.1e86c5c0.js"><link rel="prefetch" href="/assets/js/64.9c071a1e.js"><link rel="prefetch" href="/assets/js/65.61d8d11c.js"><link rel="prefetch" href="/assets/js/66.dd39544e.js"><link rel="prefetch" href="/assets/js/67.6dd79cd2.js"><link rel="prefetch" href="/assets/js/68.dd07b2a3.js"><link rel="prefetch" href="/assets/js/69.a5a81dbc.js"><link rel="prefetch" href="/assets/js/70.3f26faed.js"><link rel="prefetch" href="/assets/js/72.d4db7f16.js"><link rel="prefetch" href="/assets/js/73.e2b0a283.js"><link rel="prefetch" href="/assets/js/74.db6d3ebc.js"><link rel="prefetch" href="/assets/js/75.4516323c.js"><link rel="prefetch" href="/assets/js/76.a086fd94.js"><link rel="prefetch" href="/assets/js/77.165f6d28.js"><link rel="prefetch" href="/assets/js/78.81cd058e.js"><link rel="prefetch" href="/assets/js/79.fde8c00b.js"><link rel="prefetch" href="/assets/js/80.142b728c.js"><link rel="prefetch" href="/assets/js/81.367c9c5e.js"><link rel="prefetch" href="/assets/js/82.d23176e0.js"><link rel="prefetch" href="/assets/js/83.d9571f6f.js"><link rel="prefetch" href="/assets/js/84.6214056c.js"><link rel="prefetch" href="/assets/js/85.66cc6092.js"><link rel="prefetch" href="/assets/js/86.18dba812.js"><link rel="prefetch" href="/assets/js/87.9506d9f8.js"><link rel="prefetch" href="/assets/js/88.b42d6720.js"><link rel="prefetch" href="/assets/js/89.5c0033c4.js"><link rel="prefetch" href="/assets/js/90.069a50d4.js"><link rel="prefetch" href="/assets/js/91.61fe3c31.js"><link rel="prefetch" href="/assets/js/92.e4211585.js"><link rel="prefetch" href="/assets/js/93.6df74471.js"><link rel="prefetch" href="/assets/js/94.d61ebe6e.js"><link rel="prefetch" href="/assets/js/95.c60c8a69.js"><link rel="prefetch" href="/assets/js/96.e3124488.js"><link rel="prefetch" href="/assets/js/97.bce37e32.js"><link rel="prefetch" href="/assets/js/98.a1fb95ac.js"><link rel="prefetch" href="/assets/js/99.f9c12b84.js"><link rel="prefetch" href="/assets/js/100.0b3aaca9.js"><link rel="prefetch" href="/assets/js/101.03f32ae7.js"><link rel="prefetch" href="/assets/js/102.69cca032.js"><link rel="prefetch" href="/assets/js/103.190dc3ef.js"><link rel="prefetch" href="/assets/js/104.6e7ceda7.js"><link rel="prefetch" href="/assets/js/105.f852f5a7.js"><link rel="prefetch" href="/assets/js/106.9335f238.js"><link rel="prefetch" href="/assets/js/107.1404f516.js"><link rel="prefetch" href="/assets/js/108.dd6bb5e3.js"><link rel="prefetch" href="/assets/js/109.a87f5640.js"><link rel="prefetch" href="/assets/js/110.fb0da049.js"><link rel="prefetch" href="/assets/js/111.cc64ddd7.js"><link rel="prefetch" href="/assets/css/112.styles.75c39ee5.css"><link rel="prefetch" href="/assets/js/112.75c39ee5.js"><link rel="prefetch" href="/assets/css/113.styles.407e8d7f.css"><link rel="prefetch" href="/assets/js/113.407e8d7f.js">
    <link rel="stylesheet" href="/assets/css/112.styles.75c39ee5.css"><link rel="stylesheet" href="/assets/css/113.styles.407e8d7f.css"><link rel="stylesheet" href="/assets/css/styles.7863e8ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">油腻中年大叔</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link router-link-active">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/rubik/" class="nav-link">魔方</a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link router-link-active">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/rubik/" class="nav-link">魔方</a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/eip/camelcheatsheet.html" class="sidebar-link">Camel Cheat Sheet</a></li><li><a href="/eip/camel-split.html" class="sidebar-link">Camel分解消息</a></li><li><a href="/eip/camel-content-router.html" class="sidebar-link">Camel内容路由</a></li><li><a href="/eip/camel-component-custom.html" class="active sidebar-link">自定义Camel组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/eip/camel-component-custom.html#自定义camel组件" class="sidebar-link">自定义Camel组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/eip/camel-component-custom.html#使用bean-或者-processor" class="sidebar-link">使用Bean 或者 Processor</a></li><li class="sidebar-sub-header"><a href="/eip/camel-component-custom.html#使用processor" class="sidebar-link">使用Processor...</a></li><li class="sidebar-sub-header"><a href="/eip/camel-component-custom.html#使用camel-component扩展" class="sidebar-link">使用Camel Component扩展</a></li></ul></li></ul></li><li><a href="/eip/camel-test.html" class="sidebar-link">Camel测试</a></li><li><a href="/eip/camel-seda-direct-vm.html" class="sidebar-link">Camel SEDA Direct VM组件</a></li><li><a href="/eip/loop-in-pentaho.html" class="sidebar-link">在pentaho中使用循环</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="自定义camel组件"><a href="#自定义camel组件" aria-hidden="true" class="header-anchor">#</a> 自定义Camel组件</h2> <h3 id="使用bean-或者-processor"><a href="#使用bean-或者-processor" aria-hidden="true" class="header-anchor">#</a> 使用Bean 或者 Processor</h3> <p>一般来说，首先建议考虑使用Bean或者Processor的方式来完成自定义Camel组件的目的。实际上所有的组件都是Processor。所以如果能够使用一个简单的Class来封装逻辑，那是最好的方式。
Bean和Processor简单易用。</p> <p>java DSL</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token function">from</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bean</span><span class="token punctuation">(</span>MyBean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Spring XML DSL</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>route</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>direct:hello<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bean:bye<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>route</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>A bean: endpoint cannot be defined as the input to the route; i.e. you cannot consume from it, you can only route from some inbound message Endpoint to the bean endpoint as output. So consider using a direct: or queue: endpoint as the input.</p> <p>不能把一个<code>bean:</code>端点作为路由的输入，即不能从bean端点消费。你只能从入站消息路由到bean端点作为输出，因此，请考虑使用一个<code>direct:</code>或者<code>queue:</code> 端点作为输入</p> <h4 id="bean绑定"><a href="#bean绑定" aria-hidden="true" class="header-anchor">#</a> Bean绑定</h4> <p>Bean作为输出端点的时候，可以不指名具体的method的名字。camel会使用一个bean bind的机制来决定使用哪一个方法。
Camel消息绑定到bean的方法的调用会以不同的方式出现，以下是重要性顺序：</p> <ul><li>if the message contains the header CamelBeanMethodName then that method is invoked, converting the body to the type of the method's argument.
如果消息头中带有CamelBeanMethodName的header名称，那么CamelBeanMethodName指定的方法会被调用，消息的body会被转成方法的参数类型。
<ul><li>From Camel 2.8 onwards you can qualify parameter types to select exactly which method to use among overloads with the same name (see below for more details).
从Camel 2.8开始，您可以限定参数类型，以准确选择在具有相同名称的重载中使用哪种方法（有关详细信息，请参见下文）。</li> <li>From Camel 2.9 onwards you can specify parameter values directly in the method option (see below for more details).
从Camel 2.9开始，您可以直接在方法选项中指定参数值（有关详细信息，请参阅下文）。</li></ul></li> <li>you can explicitly specify the method name in the DSL or when using POJO Consuming or POJO Producing
您可以在DSL中或使用POJO Consuming或POJO Producing时明确指定方法名称</li> <li>if the bean has a method marked with the @Handler annotation, then that method is selected
如果bean有一个用@Handler注释标记的方法，则选择该方法</li> <li>if the bean can be converted to a Processor using the Type Converter mechanism, then this is used to process the message. The ActiveMQ component uses this mechanism to allow any JMS MessageListener to be invoked directly by Camel without having to write any integration glue code. You can use the same mechanism to integrate Camel into any other messaging/remoting frameworks.
如果bean可以使用Type Converter机制转换为Processor，那么这将用于处理消息。 ActiveMQ组件使用此机制允许Camel直接调用任何JMS MessageListener，而无需编写任何集成代码。 您可以使用相同的机制将Camel集成到任何其他消息传递/远程处理框架中。i</li> <li>if the body of the message can be converted to a BeanInvocation (the default payload used by the ProxyHelper) component - then that is used to invoke the method and pass its arguments
otherwise the type of the body is used to find a matching method; an error is thrown if a single method cannot be chosen unambiguously.
如果消息的body可以转换为BeanInvocation（ProxyHelper使用的默认载体）组件 - 那么它用于调用方法并传递其参数否则使用body的类型用于找到匹配的方法; 如果无法明确选择一个具体的方法，则会引发错误。</li> <li>you can also use Exchange as the parameter itself, but then the return type must be void.
您也可以使用Exchange作为参数本身，但返回类型必须为void。</li> <li>if the bean class is private (or package-private), interface methods will be preferred (from Camel 2.9 onwards) since Camel can't invoke class methods on such beans
如果bean类是私有的（或者是包私有的），那么接口方法将是首选的（从Camel 2.9开始），因为Camel不能在这样的bean上调用类方法</li></ul> <p>详见：http://camel.apache.org/bean-binding.html</p> <h3 id="使用processor"><a href="#使用processor" aria-hidden="true" class="header-anchor">#</a> 使用Processor...</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">from</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span>Exchange exchange<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token comment">//do something... </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>route</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>process</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>refbean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mock:result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>route</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="使用camel-component扩展"><a href="#使用camel-component扩展" aria-hidden="true" class="header-anchor">#</a> 使用Camel Component扩展</h3> <p>我们拿一个实际的例子，钉钉消息机器人来说明。
我们将要创建一个组件，这个组件把Camel消息发送到钉钉机器人的调用地址。组件可以支持不同的发送地址。</p> <h4 id="使用maven-archetype创建camel-component项目"><a href="#使用maven-archetype创建camel-component项目" aria-hidden="true" class="header-anchor">#</a> 使用maven archetype创建camel component项目</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mvn archetype:generate
    -DarchetypeGroupId<span class="token operator">=</span>org.apache.camel.archetypes
    -DarchetypeArtifactId<span class="token operator">=</span>camel-archetype-component
    -DarchetypeVersion<span class="token operator">=</span>2.23.0
    -DgroupId<span class="token operator">=</span>com.manystar
    -DartifactId<span class="token operator">=</span>camel-dingbot
	-Dname<span class="token operator">=</span>DingBot 
    -Dscheme<span class="token operator">=</span>dingbot
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这会创建出一个component项目，项目结构如图</p> <p><img src="/assets/img/structure.dd9fc3fb.png" alt="images"></p> <ul><li>META-INF/services/org/apache/camel/component/dingbot - 允许组件自动发现的配置文件,dingbot是自定义组件的uri 格式，文件内容定义了组件类。</li> <li>DingBotComponent.java - 创建 “dingbot:”端点的组件类</li> <li>DingBotEndpoin Endpoint的实现类，通过其URI(“dingbot:” 在本例中)在DSL中引用。端点负责创建与之关联的Producer和Consumer实例。</li> <li>DingBotProducer.java - 用于将消息交换发送到端点的Producer实现。</li> <li>DingBotConsumer.java - 用于从端点消费消息的Consumer实现。</li></ul> <h4 id="修改端点类"><a href="#修改端点类" aria-hidden="true" class="header-anchor">#</a> 修改端点类</h4> <p>添加代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> String <span class="token function">getDingBotUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> dingBotUri<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDingBotUri</span><span class="token punctuation">(</span>String dingBotUri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dingBotUri <span class="token operator">=</span> dingBotUri<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@UriPath</span><span class="token punctuation">(</span>description <span class="token operator">=</span> <span class="token string">&quot;Ding Bot uri&quot;</span><span class="token punctuation">,</span>defaultValue <span class="token operator">=</span> <span class="token string">&quot;DingBot&quot;</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@Metadata</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String dingBotUri<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在端点类中添加dingBotUri的参数，这将允许我们采用</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;file://src/data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convertBodyTo</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;log:com.manystar.Dingbot&quot;</span><span class="token punctuation">)</span>
	  <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;dingbot:bar?dingBotUri=https://oapi.dingtalk.com/robot/send?access_token=xxx&quot;</span><span class="token punctuation">)</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>的方式调用组件。</p> <h4 id="修改producer"><a href="#修改producer" aria-hidden="true" class="header-anchor">#</a> 修改Producer</h4> <p>这段代码负责把camel消息发送到钉钉机器人地址</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span>Exchange exchange<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        HttpClient httpClient <span class="token operator">=</span> HttpClients<span class="token punctuation">.</span><span class="token function">createDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        HttpPost httpPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpPost</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">getDingBotUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpPost<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String textMsg <span class="token operator">=</span> <span class="token string">&quot;{\&quot;msgtype\&quot;:\&quot;text\&quot;,\&quot;text\&quot;:{\&quot;content\&quot;:\&quot;&quot;</span><span class="token operator">+</span>exchange<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\&quot;}}&quot;</span><span class="token punctuation">;</span>
        StringEntity se <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringEntity</span><span class="token punctuation">(</span>textMsg<span class="token punctuation">,</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpPost<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span>se<span class="token punctuation">)</span><span class="token punctuation">;</span>
        HttpResponse response <span class="token operator">=</span> httpClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>httpPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> HttpStatus<span class="token punctuation">.</span>SC_OK<span class="token punctuation">)</span><span class="token punctuation">{</span>
            String result <span class="token operator">=</span> EntityUtils<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>至此基本工作都完成了，剩下的就是测试打包发布jar到maven库了。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/eip/camel-content-router.html" class="prev">
          Camel内容路由
        </a></span> <span class="next"><a href="/eip/camel-test.html">
          Camel测试
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/71.1234830b.js" defer></script><script src="/assets/js/app.7863e8ac.js" defer></script>
  </body>
</html>
